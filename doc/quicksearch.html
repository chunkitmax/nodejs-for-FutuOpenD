<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"typedef.js.html":{"id":"typedef.js.html","title":"Source: typedef.js","body":" FutuQuant-Nodejs Classes FutuQuantSocket Global Global Source: typedef.js // Common /** * 協議返回值 * RetType 定義協議請求返回值 請求失敗情況，除網絡超時外，其它具體原因參見各協議定義的retMsg字段 RetType_Succeed = 0; //成功 RetType_Failed = -1; //失敗 RetType_TimeOut = -100; //超時 RetType_Unknown = -400; //未知結果 * @typedef {number} RetType */ /** * 請求包標識，包的唯一標識，用於回放攻擊的識別和保護 * PacketID 用於唯一標識一次請求 serailNO 由請求方自定義填入包頭，為防回放攻擊要求自增，否則新的請求將被忽略 * @typedef {object} PacketID * @property {number} connID 當前TCP連接的連接ID，一條連接的唯一標識，InitConnect協議會返回 * @property {number} serialNo 包頭中的包自增序列號 */ // Qot_Common /** * 行情市場 * QotMarket定義一支證券所屬的行情市場分類 QotMarket_HK_Future 港股期貨，目前僅支持 999010(恆指當月期貨)、999011(恆指下月期貨) QotMarket_US_Option 美股期權，牛牛客戶端可以查看行情，API 後續支持 QotMarket_Unknown = 0; //未知市場 QotMarket_HK_Security = 1; //港股 QotMarket_HK_Future = 2; //港期貨(目前是恆指的當月、下月期貨行情) QotMarket_US_Security = 11; //美股 QotMarket_US_Option = 12; //美期權,暫時不支持期權 QotMarket_CNSH_Security = 21; //滬股 QotMarket_CNSZ_Security = 22; //深股 * * @typedef {number} QotMarket */ /** * 股票類型 * SecurityType_Unknown = 0; //未知 SecurityType_Bond = 1; //債券 SecurityType_Bwrt = 2; //一攬子權證 SecurityType_Eqty = 3; //正股 SecurityType_Trust = 4; //信托,基金 SecurityType_Warrant = 5; //渦輪 SecurityType_Index = 6; //指數 SecurityType_Plate = 7; //板塊 SecurityType_Drvt = 8; //期權 SecurityType_PlateSet = 9; //板塊集 * @typedef {number} SecurityType */ /** * 板塊集合的類型 * Qot_GetPlateSet 請求參數類型 PlateSetType_All = 0; //所有板塊 PlateSetType_Industry = 1; //行業板塊 PlateSetType_Region = 2; //地域板塊,港美股市場的地域分類數據暫為空 PlateSetType_Concept = 3; //概念板塊 * @typedef {number} PlateSetType */ /** * 窩輪子類型 * WarrantType_Unknown = 0; //未知 WarrantType_Buy = 1; //認購 WarrantType_Sell = 2; //認沽 WarrantType_Bull = 3; //牛 WarrantType_Bear = 4; //熊 * @typedef {number} WarrantType */ /** * 行情市場狀態 * QotMarketState_None = 0; // 無交易,美股未開盤 QotMarketState_Auction = 1; // 競價 QotMarketState_WaitingOpen = 2; // 早盤前等待開盤 QotMarketState_Morning = 3; // 早盤 QotMarketState_Rest = 4; // 午間休市 QotMarketState_Afternoon = 5; // 午盤 QotMarketState_Closed = 6; // 收盤 QotMarketState_PreMarketBegin = 8; // 盤前 QotMarketState_PreMarketEnd = 9; // 盤前結束 QotMarketState_AfterHoursBegin = 10; // 盤後 QotMarketState_AfterHoursEnd = 11; // 盤後結束 QotMarketState_NightOpen = 13; // 夜市開盤 QotMarketState_NightEnd = 14; // 夜市收盤 QotMarketState_FutureDayOpen = 15; // 期指日市開盤 QotMarketState_FutureDayBreak = 16; // 期指日市休市 QotMarketState_FutureDayClose = 17; // 期指日市收盤 QotMarketState_FutureDayWaitForOpen = 18; // 期指日市等待開盤 QotMarketState_HkCas = 19; // 盤後競價,港股市場增加CAS機制對應的市場狀態 * @typedef {number} QotMarketState */ /** * 復權類型 * RehabType_None = 0; //不復權 RehabType_Forward = 1; //前復權 RehabType_Backward = 2; //後復權 * @typedef {number} RehabType */ /** * K線類型，枚舉值兼容舊協議定義，新類型季K,年K,3分K暫時沒有支持歷史K線 * KLType_Unknown = 0; //未知 KLType_1Min = 1; //1分K KLType_Day = 2; //日K KLType_Week = 3; //周K KLType_Month = 4; //月K KLType_Year = 5; //年K KLType_5Min = 6; //5分K KLType_15Min = 7; //15分K KLType_30Min = 8; //30分K KLType_60Min = 9; //60分K KLType_3Min = 10; //3分K KLType_Quarter = 11; //季K * @typedef {number} KLType */ /** * 指定返回K線結構體特定某幾項數據，KLFields枚舉值或組合，如果未指定返回全部字段 * KLFields_None = 0; // KLFields_High = 1; //最高價 KLFields_Open = 2; //開盤價 KLFields_Low = 4; //最低價 KLFields_Close = 8; //收盤價 KLFields_LastClose = 16; //昨收價 KLFields_Volume = 32; //成交量 KLFields_Turnover = 64; //成交額 KLFields_TurnoverRate = 128; //換手率 KLFields_PE = 256; //市盈率 KLFields_ChangeRate = 512; //漲跌幅 * @typedef {number} KLFields */ /** * 行情定閱類型，訂閱類型，枚舉值兼容舊協議定義 * SubType_None = 0; SubType_Basic = 1; //基礎報價 SubType_OrderBook = 2; //擺盤 SubType_Ticker = 4; //逐筆 SubType_RT = 5; //分時 SubType_KL_Day = 6; //日K SubType_KL_5Min = 7; //5分K SubType_KL_15Min = 8; //15分K SubType_KL_30Min = 9; //30分K SubType_KL_60Min = 10; //60分K SubType_KL_1Min = 11; //1分K SubType_KL_Week = 12; //周K SubType_KL_Month = 13; //月K SubType_Broker = 14; //經紀隊列 SubType_KL_Qurater = 15; //季K SubType_KL_Year = 16; //年K SubType_KL_3Min = 17; //3分K * @typedef {number} SubType */ /** * 逐筆方向 * TickerDirection_Unknown = 0; //未知 TickerDirection_Bid = 1; //外盤 TickerDirection_Ask = 2; //內盤 TickerDirection_Neutral = 3; //中性盤 * @typedef {number} TickerDirection */ /** * 股票，兩個字段確定一支股票 * @typedef {object} Security * @property {QotMarket} market QotMarket,股票市場 * @property {string} code 股票代碼 */ /** * K線數據點 * @typedef {object} KLine * @property {string} time 時間戳字符串 * @property {boolean} isBlank 是否是空內容的點,若為ture則只有時間信息 * @property {number} [highPrice] 最高價 * @property {number} [openPrice] 開盤價 * @property {number} [lowPrice] 最低價 * @property {number} [closePrice] 收盤價 * @property {number} [lastClosePrice] 昨收價 * @property {number} [volume] 成交量 * @property {number} [turnover] 成交額 * @property {number} [turnoverRate] 換手率 * @property {number} [pe] 市盈率 * @property {number} [changeRate] 漲跌幅 */ /** * 基礎報價 * @typedef {object} BasicQot * @property {security} security 股票 * @property {boolean} isSuspended 是否停牌 * @property {string} listTime 上市日期字符串 * @property {number} priceSpread 價差 * @property {string} updateTime 更新時間字符串 * @property {number} highPrice 最高價 * @property {number} openPrice 開盤價 * @property {number} lowPrice 最低價 * @property {number} curPrice 最新價 * @property {number} lastClosePrice 昨收價 * @property {number} volume 成交量 * @property {number} turnover 成交額 * @property {number} turnoverRate 換手率 * @property {number} amplitude 振幅 */ /** * 分時數據點 * @typedef {object} TimeShare * @property {string} time 時間字符串 * @property {number} minute 距離0點過了多少分鐘 * @property {boolean} isBlank 是否是空內容的點,若為ture則只有時間信息 * @property {number} [price] 當前價 * @property {number} [lastClosePrice] 昨收價 * @property {number} [avgPrice] 均價 * @property {number} [volume] 成交量 * @property {number} [turnover] 成交額 */ /** * 證券基本靜態信息 * @typedef {object} SecurityStaticBasic * @property {security} security 股票 * @property {number} id 股票ID * @property {number} lotSize 每手數量 * @property {SecurityType} secType Qot_Common.SecurityType,股票類型 * @property {string} name 股票名字 * @property {string} listTime 上市時間字符串 */ /** * 窩輪額外股票靜態信息 * @typedef {object} WarrantStaticExData * @property {WarrantType} type Qot_Common.WarrantType,渦輪類型 * @property {Security} owner 所屬正股 */ /** * 證券靜態信息 * @typedef {object} SecurityStaticInfo * @property {SecurityStaticBasic} basic 基本股票靜態信息 * @property {WarrantStaticExData} [warrantExData] 窩輪額外股票靜態信息 */ /** * 買賣經紀擺盤 * @typedef {object} Broker * @property {number} id 經紀ID * @property {string} name 經紀名稱 * @property {number} pos 經紀檔位 */ /** * 逐筆成交 * @typedef {object} Ticker * @property {string} time 時間字符串 * @property {number} sequence 唯一標識 * @property {TickerDirection} dir TickerDirection, 買賣方向 * @property {number} price 價格 * @property {number} volume 成交量 * @property {number} turnover 成交額 * @property {number} [recvTime] 收到推送數據的本地時間戳，用於定位延遲 */ /** * 買賣十檔擺盤 * @typedef {object} OrderBook * @property {number} price 委托價格 * @property {number} volume 委托數量 * @property {number} orederCount 委托訂單個數 */ /** * 單個定閱類型信息 * @typedef {object} SubInfo * @property {SubType} subType Qot_Common.SubType,訂閱類型 * @property {Security[]} securityList 訂閱該類型行情的股票 */ /** * 單條連接定閱信息 * 一條連接重復定閱其它連接已經訂閱過的，不會額外消耗訂閱額度 * @typedef ConnSubInfo * @property {SubInfo[]} subInfoList 該連接訂閱信息 * @property {number} usedQuota 該連接已經使用的訂閱額度 * @property {boolean} isOwnConnData 用於區分是否是自己連接的數據 */ // Trd_Common /** * 交易環境 * TrdEnv_Simulate = 0; //仿真環境(模擬環境) TrdEnv_Real = 1; //真實環境 * @typedef {number} TrdEnv */ /** * 交易市場，是大的市場，不是具體品種 * TrdMarket_Unknown = 0; //未知市場 TrdMarket_HK = 1; //香港市場 TrdMarket_US = 2; //美國市場 TrdMarket_CN = 3; //大陸市場 TrdMarket_HKCC = 4; //香港A股通市場 * @typedef {number} TrdMarket */ /** * 交易方向，客戶端下單只傳Buy或Sell即可，SellShort是服務器返回有此方向，BuyBack目前不存在，但也不排除服務器會傳 * TrdSide_Unknown = 0; //未知方向 TrdSide_Buy = 1; //買入 TrdSide_Sell = 2; //賣出 TrdSide_SellShort = 3; //賣空 TrdSide_BuyBack = 4; //買回 * @typedef {number} TrdSide */ /** * 訂單類型 * OrderType_Unknown = 0; //未知類型 OrderType_Normal = 1; //普通訂單(港股的增強限價單、A股的限價委托、美股的限價單) OrderType_Market = 2; //市價訂單(目前僅美股) OrderType_AbsoluteLimit = 5; //絕對限價訂單(目前僅港股)，只有價格完全匹配才成交，比如你下價格為5元的買單，賣單價格必須也要是5元才能成交，低於5元也不能成交。賣出同理 OrderType_Auction = 6; //競價訂單(目前僅港股)，A股的早盤競價訂單類型不變還是OrderType_Normal OrderType_AuctionLimit = 7; //競價限價訂單(目前僅港股) OrderType_SpecialLimit = 8; //特別限價訂單(目前僅港股)，成交規則同OrderType_AbsoluteLimit，且如果當前沒有對手可成交，不能立即成交，交易所自動撤銷訂單 * @typedef {number} OrderType */ /** * 訂單狀態 * OrderStatus_Unsubmitted = 0; //未提交 OrderStatus_Unknown = -1; //未知狀態 OrderStatus_WaitingSubmit = 1; //等待提交 OrderStatus_Submitting = 2; //提交中 OrderStatus_SubmitFailed = 3; //提交失敗，下單失敗 OrderStatus_TimeOut = 4; //處理超時，結果未知 OrderStatus_Submitted = 5; //已提交，等待成交 OrderStatus_Filled_Part = 10; //部分成交 OrderStatus_Filled_All = 11; //全部已成 OrderStatus_Cancelling_Part = 12; //正在撤單_部分(部分已成交，正在撤銷剩余部分) OrderStatus_Cancelling_All = 13; //正在撤單_全部 OrderStatus_Cancelled_Part = 14; //部分成交，剩余部分已撤單 OrderStatus_Cancelled_All = 15; //全部已撤單，無成交 OrderStatus_Failed = 21; //下單失敗，服務拒絕 OrderStatus_Disabled = 22; //已失效 OrderStatus_Deleted = 23; //已刪除，無成交的訂單才能刪除 * @typedef {number} OrderStatus */ /** * 持倉方向類型 * PositionSide_Long = 0; //多倉，默認情況是多倉 PositionSide_Unknown = -1; //未知方向 PositionSide_Short = 1; //空倉 * @typedef {number} PositionSide */ /** * 修改訂單的操作類型，港股支持全部操作，美股目前僅支持ModifyOrderOp_Normal和ModifyOrderOp_Cancel * ModifyOrderOp_Unknown = 0; //未知操作 ModifyOrderOp_Normal = 1; //修改訂單的價格、數量等，即以前的改單 ModifyOrderOp_Cancel = 2; //撤單 ModifyOrderOp_Disable = 3; //失效 ModifyOrderOp_Enable = 4; //生效 ModifyOrderOp_Delete = 5; //刪除 * @typedef {number} ModifyOrderOp */ /** * 需要再次確認訂單的原因枚舉 * ReconfirmOrderReason_Unknown = 0; //未知原因 ReconfirmOrderReason_QtyTooLarge = 1; //訂單數量太大，確認繼續下單並否拆分成多個小訂單 ReconfirmOrderReason_PriceAbnormal = 2; //價格異常，偏離當前價太大，確認繼續下單 * @typedef {number} ReconfirmOrderReason */ /** * 交易協議公共參數頭 * @typedef {object} TrdHeader * @property {TrdEnv} trdEnv 交易環境, 參見TrdEnv的枚舉定義 * @property {number} accID 業務賬號, 業務賬號與交易環境、市場權限需要匹配，否則會返回錯誤 * @property {TrdMarket} trdMarket 交易市場, 參見TrdMarket的枚舉定義 */ /** * 交易業務賬戶結構 * @typedef {object} TrdAcc * @property {TrdEnv} trdEnv 交易環境, 參見TrdEnv的枚舉定義 * @property {number} accID 業務賬號, 業務賬號與交易環境、市場權限需要匹配，否則會返回錯誤 * @property {TrdMarket} trdMarketAuthList 業務賬戶支持的交易市場權限，即此賬戶能交易那些市場, 可擁有多個交易市場權限，目前僅單個，取值參見TrdMarket的枚舉定義 */ /** * 賬戶資金結構 * @typedef {object} Funds * @property {number} power 購買力，3位精度(A股2位)，下同 * @property {number} totalAssets 資產淨值 * @property {number} cash 現金 * @property {number} marketVal 證券市值 * @property {number} frozenCash 凍結金額 * @property {number} debtCash 欠款金額 * @property {number} avlWithdrawalCash 可提金額 */ /** * 賬戶持倉結構 * @typedef {object} Position * @property {number} positionID 持倉ID，一條持倉的唯一標識 * @property {PositionSide} positionSide 持倉方向，參見PositionSide的枚舉定義 * @property {string} code 代碼 * @property {string} name 名稱 * @property {number} qty 持有數量，2位精度，期權單位是&quot;張&quot;，下同 * @property {number} canSellQty 可賣數量 * @property {number} price 市價，3位精度(A股2位) * @property {number} [costPrice] 成本價，無精度限制，如果沒傳，代表此時此值無效 * @property {number} val 市值，3位精度(A股2位) * @property {number} plVal 盈虧金額，3位精度(A股2位) * @property {number} [plRatio] 盈虧比例，無精度限制，如果沒傳，代表此時此值無效 * @property {number} [td_plVal] 今日盈虧金額，3位精度(A股2位)，下同 * @property {number} [td_trdVal] 今日交易額 * @property {number} [td_buyVal] 今日買入總額 * @property {number} [td_buyQty] 今日買入總量 * @property {number} [td_sellVal] 今日賣出總額 * @property {number} [td_sellQty] 今日賣出總量 */ /** * 訂單結構 * @typedef {object} Order * @property {TrdSide} trdSide 交易方向, 參見TrdSide的枚舉定義 * @property {OrderType} orderType 訂單類型, 參見OrderType的枚舉定義 * @property {OrderStatus} orderStatus 訂單狀態, 參見OrderStatus的枚舉定義 * @property {number} orderID 訂單號 * @property {string} orderIDEx 擴展訂單號 * @property {string} code 代碼 * @property {string} name 名稱 * @property {number} qty 訂單數量，2位精度，期權單位是&quot;張&quot; * @property {number} [price] 訂單價格，3位精度(A股2位) * @property {string} createTime 創建時間，嚴格按YYYY-MM-DD HH:MM:SS或YYYY-MM-DD HH:MM:SS.MS格式傳 * @property {string} updateTime 最後更新時間，嚴格按YYYY-MM-DD HH:MM:SS或YYYY-MM-DD HH:MM:SS.MS格式傳 * @property {number} [fillQty] 成交數量，2位精度，期權單位是&quot;張&quot; * @property {number} [fillAvgPrice] 成交均價，無精度限制 * @property {string} [lastErrMsg] 最後的錯誤描述，如果有錯誤，會有此描述最後一次錯誤的原因，無錯誤為空 */ /** * 成交結構 * @typedef {object} OrderFill * @property {number} trdSide 交易方向, 參見TrdSide的枚舉定義 * @property {number} fillID 成交號 * @property {string} fillIDEx 擴展成交號 * @property {number} [orderID] 訂單號 * @property {string} [orderIDEx] 擴展訂單號 * @property {string} code 代碼 * @property {string} name 名稱 * @property {number} qty 訂單數量，2位精度，期權單位是&quot;張&quot; * @property {number} price 訂單價格，3位精度(A股2位) * @property {string} createTime 創建時間（成交時間），嚴格按YYYY-MM-DD HH:MM:SS或YYYY-MM-DD HH:MM:SS.MS格式傳 * @property {number} [counterBrokerID] 對手經紀號，港股有效 * @property {string} [counterBrokerName] 對手經紀名稱，港股有效 */ /** * 最大交易數量 * @description 因目前服務器實現的問題，賣空需要先賣掉持倉才能再賣空，是分開兩步賣的，買回來同樣是逆向兩步；而看多的買是可以現金加融資一起一步買的，請注意這個差異 * @typedef {object} MaxTrdQtys * @property {number} maxCashBuy 不使用融資，僅自己的現金最大可買整手股數 * @property {number} [maxCashAndMarginBuy] 使用融資，自己的現金 + 融資資金總共的最大可買整手股數 * @property {number} maxPositionSell 不使用融券(賣空)，僅自己的持倉最大可賣整手股數 * @property {number} [maxSellShort] 使用融券(賣空)，最大可賣空整手股數，不包括多倉 * @property {number} [maxBuyBack] 賣空後，需要買回的最大整手股數。因為賣空後，必須先買回已賣空的股數，還掉股票，才能再繼續買多。 */ /** * 過濾條件，條件組合是&quot;與&quot;不是&quot;或&quot;，用於獲取訂單、成交、持倉等時二次過濾 * @typedef {object} TrdFilterConditions * @property {string[]} codeList 代碼過濾，只返回包含這些代碼的數據，沒傳不過濾 * @property {number[]} idList ID主鍵過濾，只返回包含這些ID的數據，沒傳不過濾，訂單是orderID、成交是fillID、持倉是positionID * @property {string} [beginTime] 開始時間，嚴格按YYYY-MM-DD HH:MM:SS或YYYY-MM-DD HH:MM:SS.MS格式傳，對持倉無效，拉歷史數據必須填 * @property {string} [endTime] 結束時間，嚴格按YYYY-MM-DD HH:MM:SS或YYYY-MM-DD HH:MM:SS.MS格式傳，對持倉無效，拉歷史數據必須填 */ × Search results Close Documentation generated by JSDoc 3.5.5 on 2018-08-28T13:24:55+08:00 using the DocStrap template. "},"futuquant.js.html":{"id":"futuquant.js.html","title":"Source: futuquant.js","body":" FutuQuant-Nodejs Classes FutuQuantSocket Global Global Source: futuquant.js const bunyan = require('bunyan'); const bunyanDebugStream = require('bunyan-debug-stream'); const Socket = require('./socket'); const sleep = async time =&gt; new Promise((resolve) =&gt; { setTimeout(resolve, time); }); /** * 封裝FutuQuant底層協議模塊 */ class FutuQuant { /** * Creates an instance of FutuQuant. * @param {object} params 初始化參數 * @param {string} params.ip FutuOpenD服務IP * @param {number} params.port FutuOpenD服務端口 * @param {number} params.userID 牛牛號 * @param {string} params.pwdMd5 解鎖交易 md5 * @param {TrdMarket} [params.market] 市場環境，默認為港股環境，1港股2美股3大陸市場4香港A股通市場 * @param {TrdEnv} [params.env] 0為仿真環境，1為真實環境，2為回測環境，默認為1 * @param {object} [logger] 日志對象，若不傳入，則使用bunyan.createLogger創建 * @memberof FutuQuant */ constructor(params, logger) { if (typeof params !== 'object') throw new Error('傳入參數類型錯誤'); // 處理參數 const { ip, port, userID, market, pwdMd5, env, } = params; if (!ip) throw new Error('必須指定FutuOpenD服務的ip'); if (!port) throw new Error('必須指定FutuOpenD服務的port'); if (!userID) throw new Error('必須指定FutuOpenD服務的牛牛號'); if (!pwdMd5) throw new Error('必須指定FutuOpenD服務的解鎖 MD5'); this.logger = logger; this.market = market || 1; // 當前市場環境，1港股2美股3大陸市場4香港A股通市場 this.userID = userID; this.pwdMd5 = pwdMd5; this.params = params; this.env = env; if (typeof this.env !== 'number') this.env = 1; // 0為仿真環境，1為真實環境，2為回測環境 // 處理日志 const methods = ['debug', 'info', 'warn', 'error', 'fatal', 'trace']; if (this.logger) { methods.forEach((key) =&gt; { if (typeof this.logger[key] !== 'function') this.logger = null; }); } this.logger = this.logger || bunyan.createLogger({ name: 'sys', streams: [{ level: 'debug', type: 'raw', serializers: bunyanDebugStream.serializers, stream: bunyanDebugStream({ forceColor: true }), }], }); this.socket = new Socket(ip, port, this.logger); // 實例化的socket對象,所有行情拉取接口 this.inited = false; // 是否已經初始化 this.trdHeader = null; // 交易公共頭部信息 this.timerKeepLive = null; // 保持心跳定時器 } /** * 初始化處理 */ async init() { if (this.inited) return; await this.initConnect(); await this.limitExecTimes(30 * 1000, 10, async () =&gt; { await this.trdUnlockTrade(true, this.pwdMd5); // 解鎖交易密碼 }); const { accID } = (await this.trdGetAccList())[0]; // 獲取交易賬戶 await this.setCommonTradeHeader(this.env, accID, this.market); // 設置為港股的真實環境 this.inited = true; } /** * 初始化連接，InitConnect.proto協議返回對象 * @typedef InitConnectResponse * @property {number} serverVer FutuOpenD的版本號 * @property {number} loginUserID FutuOpenD登陸的牛牛用戶ID * @property {number} connID 此連接的連接ID，連接的唯一標識 * @property {string} connAESKey 此連接後續AES加密通信的Key，固定為16字節長字符串 * @property {number} keepAliveInterval 心跳保活間隔 */ /** * InitConnect.proto - 1001初始化連接 * nodejs版本會根據返回的keepAliveInterval字段自動保持心跳連接，不再需要手動調用ft.keepLive()方法。 請求其它協議前必須等InitConnect協議先完成 若FutuOpenD配置了加密， 「connAESKey」將用於後續協議加密 keepAliveInterval 為建議client發起心跳 KeepAlive 的間隔 * @async * @param {object} params 初始化參數 * @param {number} params.clientVer 客戶端版本號，clientVer = &quot;.&quot;以前的數 * 100 + &quot;.&quot;以後的，舉例：1.1版本的clientVer為1 * 100 + 1 = 101，2.21版本為2 * 100 + 21 = 221 * @param {string} params.clientID 客戶端唯一標識，無生具體生成規則，客戶端自己保證唯一性即可 * @param {boolean} params.recvNotify 此連接是否接收市場狀態、交易需要重新解鎖等等事件通知，true代表接收，FutuOpenD就會向此連接推送這些通知，反之false代表不接收不推送 * @returns {InitConnectResponse} */ async initConnect(params) { if (this.inited) throw new Error('請勿重復初始化連接'); return new Promise(async (resolve) =&gt; { this.socket.onConnect(async () =&gt; { const res = await this.socket.send('InitConnect', Object.assign({ clientVer: 101, clientID: 'yisbug', recvNotify: true, }, params)); // 保持心跳 this.connID = res.connID; this.connAESKey = res.connAESKey; this.keepAliveInterval = res.keepAliveInterval; if (this.timerKeepLive) { clearInterval(this.timerKeepLive); this.timerKeepLive = null; } this.timerKeepLive = setInterval(() =&gt; this.keepAlive(), 1000 * this.keepAliveInterval); resolve(res); }); await this.socket.init(); }); } /** * 斷開連接 */ close() { if (this.timerKeepLive) { clearInterval(this.timerKeepLive); this.socket.close(); this.inited = false; } } /** * GetGlobalState.proto協議返回對象 * @typedef GetGlobalStateResponse * @property {QotMarketState} marketHK Qot_Common.QotMarketState,港股主板市場狀態 * @property {QotMarketState} marketUS Qot_Common.QotMarketState,美股Nasdaq市場狀態 * @property {QotMarketState} marketSH Qot_Common.QotMarketState,滬市狀態 * @property {QotMarketState} marketSZ Qot_Common.QotMarketState,深市狀態 * @property {QotMarketState} marketHKFuture Qot_Common.QotMarketState,港股期貨市場狀態 * @property {boolean} qotLogined 是否登陸行情服務器 * @property {boolean} trdLogined 是否登陸交易服務器 * @property {number} serverVer 版本號 * @property {number} serverBuildNo buildNo * @property {number} time 當前格林威治時間 */ /** * GetGlobalState.proto - 1002獲取全局狀態 * @async * @returns {GetGlobalStateResponse} */ getGlobalState() { return this.socket.send('GetGlobalState', { userID: this.userID, }); } /** * KeepAlive.proto - 1004保活心跳 * @returns {number} time 服務器回包時的格林威治時間戳，單位秒 */ async keepAlive() { const time = await this.socket.send('KeepAlive', { time: Math.round(Date.now() / 1000), }); return time; } /** * Qot_Sub.proto - 3001訂閱或者反訂閱 * 股票結構參考 Security 訂閱數據類型參考 SubType 復權類型參考 RehabType 為控制定閱產生推送數據流量，股票定閱總量有額度控制，訂閱規則參考 高頻數據接口 高頻數據接口需要訂閱之後才能使用，注冊推送之後才可以收到數據更新推送 * @param {object} params * @param {Security[]} params.securityList 股票 * @param {SubType[]} params.subTypeList Qot_Common.SubType,訂閱數據類型 * @param {boolean} [params.isSubOrUnSub=true] ture表示訂閱,false表示反訂閱 * @param {boolean} [params.isRegOrUnRegPush=true] 是否注冊或反注冊該連接上面行情的推送,該參數不指定不做注冊反注冊操作 * @param {number} params.regPushRehabTypeList Qot_Common.RehabType,復權類型,注冊推送並且是K線類型才生效,其他訂閱類型忽略該參數,注冊K線推送時該參數不指定默認前復權 * @param {boolean} [params.isFirstPush=true] 注冊後如果本地已有數據是否首推一次已存在數據,該參數不指定則默認true * @async */ qotSub(params) { return this.socket.send('Qot_Sub', Object.assign({ securityList: [], subTypeList: [], isSubOrUnSub: true, isRegOrUnRegPush: true, regPushRehabTypeList: [], isFirstPush: true, }, params)); } /** * Qot_RegQotPush.proto - 3002注冊行情推送 * 股票結構參考 Security 訂閱數據類型參考 SubType 復權類型參考 RehabType 行情需要訂閱成功才能注冊推送 * @param {object} params Object * @param {Security[]} params.securityList 股票 * @param {SubType[]} params.subTypeList Qot_Common.SubType,訂閱數據類型 * @param {SubType[]} params.rehabTypeList Qot_Common.RehabType,復權類型,注冊K線類型才生效,其他訂閱類型忽略該參數,注冊K線時該參數不指定默認前復權 * @param {boolean} [params.isRegOrUnReg=true] 注冊或取消 * @param {boolean} [params.isFirstPush=true] 注冊後如果本地已有數據是否首推一次已存在數據,該參數不指定則默認true * @async */ qotRegQotPush(params) { // 3002注冊行情推送 return this.socket.send('Qot_RegQotPush', Object.assign({ securityList: [], subTypeList: [], rehabTypeList: [], isRegOrUnReg: true, isFirstPush: true, }, params)); } /** * Qot_GetSubInfo.proto協議返回對象 * @typedef QotGetSubInfoResponse * @property {ConnSubInfo[]} connSubInfoList 訂閱信息 * @property {number} totalUsedQuota FutuOpenD已使用的訂閱額度 * @property {number} remainQuota FutuOpenD剩余訂閱額度 */ /** * Qot_GetSubInfo.proto - 3003獲取訂閱信息 * @async * @param {boolean} [isReqAllConn=false] 是否返回所有連接的訂閱狀態，默認false * @returns {QotGetSubInfoResponse} */ qotGetSubInfo(isReqAllConn = false) { // 3003獲取訂閱信息 return this.socket.send('Qot_RegQotPush', { isReqAllConn, }); } /** * Qot_GetBasicQot.proto - 3004獲取股票基本行情 * 股票結構參考 Security 基本報價結構參考 BasicQot * @param {Security[]} securityList 股票列表 * @returns {BasicQot[]} basicQotList 股票基本報價 * @async */ async qotGetBasicQot(securityList) { // 3004獲取股票基本行情 return (await this.socket.send('Qot_GetBasicQot', { securityList, })).basicQotList || []; } /** * 注冊股票基本報價通知，需要先調用訂閱接口 * Qot_UpdateBasicQot.proto - 3005推送股票基本報價 * @async * @param {function} callback 回調 * @returns {BasicQot[]} basicQotList */ subQotUpdateBasicQot(callback) { // 注冊股票基本報價通知 return this.socket.subNotify(3005, data =&gt; callback(data.basicQotList || [])); } /** * Qot_GetKL.proto - 3006獲取K線 * 復權類型參考 RehabType K線類型參考 KLType 股票結構參考 Security K線結構參考 KLine 請求K線目前最多最近1000根 * @param {object} params * @param {RehabType} params.rehabType Qot_Common.RehabType,復權類型 * @param {KLType} params.klType Qot_Common.KLType,K線類型 * @param {Security} params.security 股票 * @param {number} params.reqNum 請求K線根數 * @async * @returns {KLine[]} k線點 */ async qotGetKL(params) { // 3006獲取K線 return (await this.socket.send('Qot_GetKL', Object.assign({ rehabType: 1, // Qot_Common.RehabType,復權類型 klType: 1, // Qot_Common.KLType,K線類型 security: {}, // 股票 reqNum: 60, // 請求K線根數 }, params))).klList || []; } /** * Qot_UpdateKL.proto協議返回對象 * @typedef QotUpdateKLResponse * @property {RehabType} rehabType Qot_Common.RehabType,復權類型 * @property {KLType} klType Qot_Common.KLType,K線類型 * @property {Security} security 股票 * @property {KLine[]} klList 推送的k線點 */ /** * 注冊K線推送，需要先調用訂閱接口 * Qot_UpdateKL.proto - 3007推送K線 * @async * @returns {QotUpdateKLResponse} 推送的k線點 */ subQotUpdateKL(callback) { // 注冊K線推送 return this.socket.subNotify(3007, callback); } /** * Qot_GetRT.proto - 3008獲取分時 * @async * @param {Security} security 股票 * @returns {TimeShare[]} 分時點 */ async qotGetRT(security) { // 獲取分時 return (await this.socket.send('Qot_GetRT', { security, })).rtList || []; } /** * 注冊分時推送，需要先調用訂閱接口 * Qot_UpdateRT.proto - 3009推送分時 * @async * @returns {TimeShare[]} 分時點 */ subQotUpdateRT(callback) { // 注冊分時推送 return this.socket.subNotify(3009, data =&gt; callback(data.rtList || [])); } /** * Qot_GetTicker.proto - 3010獲取逐筆 * 股票結構參考 Security 逐筆結構參考 Ticker 請求逐筆目前最多最近1000個 * @param {Security} security 股票 * @param {number} maxRetNum 最多返回的逐筆個數,實際返回數量不一定會返回這麼多,最多返回1000個，默認100 * @returns {Ticker[]} 逐筆 * @async */ async qotGetTicker(security, maxRetNum = 100) { // 3010獲取逐筆 return (await this.socket.send('Qot_GetTicker', { security, maxRetNum, })).tickerList || []; } /** * Qot_GetTicker.proto協議返回對象 * @typedef subQotUpdateTickerResponse * @property {Security} security 股票 * @property {Ticker[]} tickerList 逐筆 */ /** * 注冊逐筆推送，需要先調用訂閱接口 * Qot_UpdateTicker.proto - 3011推送逐筆 * @async * @param {function} callback 回調 * @returns {subQotUpdateTickerResponse} 逐筆 */ subQotUpdateTicker(callback) { // 注冊逐筆推送 return this.socket.subNotify(3011, callback); } /** * Qot_GetOrderBook.proto協議返回對象 * @typedef QotGetOrderBookResponse * @property {Security} security 股票 * @property {OrderBook[]} orderBookAskList 賣盤 * @property {OrderBook[]} sellList 賣盤，同orderBookAskList * @property {OrderBook[]} orderBookBidList 買盤 * @property {OrderBook[]} buyList 買盤，同orderBookBidList */ /** * Qot_GetOrderBook.proto - 3012獲取買賣盤，需要先調用訂閱接口 * @async * @param {Security} security 股票 * @param {number} num 請求的擺盤個數（1-10），默認10 * @returns {QotGetOrderBookResponse} */ async qotGetOrderBook(security, num = 10) { // 3012獲取買賣盤 const result = await this.socket.send('Qot_GetOrderBook', { security, num, }); result.orderBookAskList = result.orderBookAskList || []; result.orderBookBidList = result.orderBookBidList || []; result.sellList = result.orderBookAskList; result.buyList = result.orderBookBidList; result.sellList.forEach((item) =&gt; { item.volume = Number(item.volume); }); result.buyList.forEach((item) =&gt; { item.volume = Number(item.volume); }); return result; } /** * 注冊買賣盤推送，需要先調用訂閱接口 * Qot_UpdateOrderBook.proto - 3013推送買賣盤 * @async * @param {function} callback 回調 * @const {QotGetOrderBookResponse} */ subQotUpdateOrderBook(callback) { // 注冊買賣盤推送 return this.socket.subNotify(3013, (data) =&gt; { data.sellList = data.orderBookAskList || []; data.buyList = data.orderBookBidList || []; data.sellList.forEach((item) =&gt; { item.volume = Number(item.volume); }); data.buyList.forEach((item) =&gt; { item.volume = Number(item.volume); }); callback(data); }); } /** * Qot_GetBroker.proto協議返回對象 * @typedef QotGetBrokerResponse * @property {Security} security 股票 * @property {Broker[]} brokerAskList 經紀Ask(賣)盤 * @property {Broker[]} sellList 經紀Ask(賣)盤，同brokerAskList * @property {Broker[]} brokerBidList 經紀Bid(買)盤 * @property {Broker[]} buyList 經紀Bid(買)盤，同brokerBidList */ /** * Qot_GetBroker.proto - 3014獲取經紀隊列 * @async * @param {Security} security Object 股票 * @returns {QotGetBrokerResponse} */ async qotGetBroker(security) { // 3014獲取經紀隊列 const result = await this.socket.send('Qot_GetBroker', { security, }); result.brokerAskList = result.brokerAskList || []; result.brokerBidList = result.brokerBidList || []; result.sellList = result.brokerAskList; result.buyList = result.brokerBidList; return result; } /** * 注冊經紀隊列推送，需要先調用訂閱接口 * Qot_UpdateBroker.proto - 3015推送經紀隊列 * @async * @param {function} callback 回調 * @returns {QotGetBrokerResponse} */ subQotUpdateBroker(callback) { // 注冊經紀隊列推送 return this.socket.subNotify(3015, (result) =&gt; { result.brokerAskList = result.brokerAskList || []; result.brokerBidList = result.brokerBidList || []; result.sellList = result.brokerAskList; result.buyList = result.brokerBidList; callback(result); }); } /** * Qot_GetHistoryKL.proto - 3100獲取單只股票一段歷史K線 * @async * @param {object} params * @param {RehabType} params.rehabType Qot_Common.RehabType,復權類型 * @param {KLType} params.klType Qot_Common.KLType,K線類型 * @param {Security} params.security 股票市場以及股票代碼 * @param {string} params.beginTime 開始時間字符串 * @param {string} params.endTime 結束時間字符串 * @param {number} [params.maxAckKLNum] 最多返回多少根K線，如果未指定表示不限制 * @param {number} [params.needKLFieldsFlag] 指定返回K線結構體特定某幾項數據，KLFields枚舉值或組合，如果未指定返回全部字段 * @returns {KLine[]} */ async qotGetHistoryKL(params) { // 3100獲取單只股票一段歷史K線 return (await this.socket.send('Qot_GetHistoryKL', Object.assign({ rehabType: 1, // Qot_Common.RehabType,復權類型 klType: 1, // Qot_Common.KLType,K線類型 security: {}, // 股票市場以及股票代碼 beginTime: '', // 開始時間字符串 endTime: '', // 結束時間字符串 // maxAckKLNum: 60, // 最多返回多少根K線，如果未指定表示不限制 // needKLFieldsFlag: 512, // 指定返回K線結構體特定某幾項數據，KLFields枚舉值或組合，如果未指定返回全部字段 }, params))).klList || []; } /** * 當請求時間點數據為空時，如何返回數據 * NoDataMode_Null = 0; //直接返回空數據 NoDataMode_Forward = 1; //往前取值，返回前一個時間點數據 NoDataMode_Backward = 2; //向後取值，返回後一個時間點數據 * @typedef {number} NoDataMode */ /** * 這個時間點返回數據的狀態以及來源 * DataStatus_Null = 0; //空數據 DataStatus_Current = 1; //當前時間點數據 DataStatus_Previous = 2; //前一個時間點數據 DataStatus_Back = 3; //後一個時間點數據 * @typedef {number} DataStatus */ /** * K線數據 * * @typedef HistoryPointsKL * @property {DataStatus} status DataStatus,數據狀態 * @property {string} reqTime 請求的時間 * @property {KLine} kl K線數據 */ /** * 多只股票的多點歷史K線點 * * @typedef SecurityHistoryKLPoints * @property {Security} security 股票 * @property {HistoryPointsKL} klList K線數據 */ /** * Qot_GetHistoryKLPoints.proto - 3101獲取多只股票多點歷史K線 * 復權類型參考 RehabType K線類型參考 KLType 股票結構參考 Security K線結構參考 KLine K線字段類型參考 KLFields 目前限制最多5個時間點，股票個數不做限制，但不建議傳入過多股票，查詢耗時過多會導致協議返回超時。 * @async * @param {object} params * @param {RehabType} params.rehabType Qot_Common.RehabType,復權類型 * @param {KLType} params.klType Qot_Common.KLType,K線類型 * @param {NoDataMode} params.noDataMode NoDataMode,當請求時間點數據為空時，如何返回數據 * @param {Security[]} params.securityList 股票市場以及股票代碼 * @param {string[]} params.timeList 時間字符串 * @param {number} [params.maxReqSecurityNum] 最多返回多少只股票的數據，如果未指定表示不限制 * @param {KLFields} [params.needKLFieldsFlag] 指定返回K線結構體特定某幾項數據，KLFields枚舉值或組合，如果未指定返回全部字段 * @returns {SecurityHistoryKLPoints[]} */ qotGetHistoryKLPoints(params) { // 3101獲取多只股票多點歷史K線 return this.socket.send('Qot_GetHistoryKLPoints', Object.assign({ rehabType: 1, // Qot_Common.RehabType,復權類型 klType: 1, // Qot_Common.KLType,K線類型 noDataMode: 0, // NoDataMode,當請求時間點數據為空時，如何返回數據。0 securityList: [], // 股票市場以及股票代碼 timeList: [], // 時間字符串 maxReqSecurityNum: 60, // 最多返回多少只股票的數據，如果未指定表示不限制 needKLFieldsFlag: 512, // 指定返回K線結構體特定某幾項數據，KLFields枚舉值或組合，如果未指定返回全部字段 }, params)).klPointList || []; } /** * 公司行動組合,指定某些字段值是否有效 * CompanyAct_None = 0; //無 CompanyAct_Split = 1; //拆股 CompanyAct_Join = 2; //合股 CompanyAct_Bonus = 4; //送股 CompanyAct_Transfer = 8; //轉贈股 CompanyAct_Allot = 16; //配股 CompanyAct_Add = 32; //增發股 CompanyAct_Dividend = 64; //現金分紅 CompanyAct_SPDividend = 128; //特別股息 * @typedef {number} CompanyAct */ /** * 復權信息 * * @typedef Rehab * @property {string} time 時間字符串 * @property {CompanyAct} companyActFlag 公司行動組合,指定某些字段值是否有效 * @property {number} fwdFactorA 前復權因子A * @property {number} fwdFactorB 前復權因子B * @property {number} bwdFactorA 後復權因子A * @property {number} bwdFactorB 後復權因子B * @property {number} [splitBase] 拆股(eg.1拆5，Base為1，Ert為5) * @property {number} [splitErt] * @property {number} [joinBase] 合股(eg.50合1，Base為50，Ert為1) * @property {number} [joinErt] * @property {number} [bonusBase] 送股(eg.10送3, Base為10,Ert為3) * @property {number} [bonusErt] * @property {number} [transferBase] 轉贈股(eg.10轉3, Base為10,Ert為3) * @property {number} [transferErt] * @property {number} [allotBase] 配股(eg.10送2, 配股價為6.3元, Base為10, Ert為2, Price為6.3) * @property {number} [allotErt] * @property {number} [allotPrice] * @property {number} [addBase] 增發股(eg.10送2, 增發股價為6.3元, Base為10, Ert為2, Price為6.3) * @property {number} [addErt] * @property {number} [addPrice] * @property {number} [dividend] 現金分紅(eg.每10股派現0.5元,則該字段值為0.05) * @property {number} [spDividend] 特別股息(eg.每10股派特別股息0.5元,則該字段值為0.05) */ /** * 股票復權信息 * * @typedef SecurityRehab * @property {Security} security 股票 * @property {Rehab[]} rehabList 復權信息 */ /** * Qot_GetRehab.proto - 3102獲取復權信息 * @async * @param {Security[]} securityList 股票列表 * @returns {SecurityRehab[]} securityRehabList 多支股票的復權信息 */ qotGetRehab(securityList) { // 3102獲取復權信息 return this.socket.send('Qot_GetRehab', { securityList, }); } /** * TradeDate * * @typedef TradeDate * @property {string} time 時間字符串 */ /** * Qot_GetTradeDate.proto - 3200獲取市場交易日 * @async * @param {QotMarket} market Qot_Common.QotMarket,股票市場 * @param {string} beginTime 開始時間字符串 2018-01-01 00:00:00 * @param {string} endTime 結束時間字符串 2018-02-01 00:00:00 * @return {TradeDate[]} tradeDateList 交易日 */ async qotGetTradeDate(market = 1, beginTime, endTime) { // 3200獲取市場交易日 return (await this.socket.send('Qot_GetTradeDate', { market, beginTime, endTime, })).tradeDateList || []; } /** * Qot_GetStaticInfo.proto - 3202獲取股票靜態信息 * @async * @param {QotMarket} market Qot_Common.QotMarket,股票市場 * @param {SecurityType} secType Qot_Common.SecurityType,股票類型 * @returns {SecurityStaticInfo[]} 靜態信息數組 */ async qotGetStaticInfo(market = 1, secType) { // 3202獲取股票靜態信息 return (await this.socket.send('Qot_GetStaticInfo', { market, secType, })).staticInfoList || []; } /** * 正股類型額外數據 * @typedef EquitySnapshotExData * @property {number} issuedShares 發行股本,即總股本 * @property {number} issuedMarketVal 總市值 =總股本*當前價格 * @property {number} netAsset 資產淨值 * @property {number} netProfit 盈利（虧損） * @property {number} earningsPershare 每股盈利 * @property {number} outstandingShares 流通股本 * @property {number} outstandingMarketVal 流通市值 =流通股本*當前價格 * @property {number} netAssetPershare 每股淨資產 * @property {number} eyRate 收益率 * @property {number} peRate 市盈率 * @property {number} pbRate 市淨率 */ /** * 渦輪類型額外數據 * @typedef WarrantSnapshotExData * @property {number} conversionRate 換股比率 * @property {WarrantType} warrantType Qot_Common.WarrantType,渦輪類型 * @property {number} strikePrice 行使價 * @property {string} maturityTime 到期日時間字符串 * @property {string} endTradeTime 最後交易日時間字符串 * @property {Security} owner 所屬正股 * @property {number} recoveryPrice 回收價 * @property {number} streetVolumn 街貨量 * @property {number} issueVolumn 發行量 * @property {number} streetRate 街貨佔比 * @property {number} delta 對沖值 * @property {number} impliedVolatility 引申波幅 * @property {number} premium 溢價 */ /** * 基本快照數據 * @typedef SnapshotBasicData * @property {Security} security 股票 * @property {SecurityType} type Qot_Common.SecurityType,股票類型 * @property {boolean} isSuspend 是否停牌 * @property {string} listTime 上市時間字符串 * @property {number} lotSize 每手數量 * @property {number} priceSpread 價差 * @property {string} updateTime 更新時間字符串 * @property {number} highPrice 最新價 * @property {number} openPrice 開盤價 * @property {number} lowPrice 最低價 * @property {number} lastClosePrice 昨收價 * @property {number} curPrice 最新價 * @property {number} volume 成交量 * @property {number} turnover 成交額 * @property {number} turnoverRate 換手率 */ /** * 快照 * @typedef Snapshot * @property {SnapshotBasicData} basic 快照基本數據 * @property {EquitySnapshotExData} [equityExData] 正股快照額外數據 * @property {WarrantSnapshotExData} [warrantExData] 窩輪快照額外數據 */ /** * Qot_GetSecuritySnapshot.proto - 3203獲取股票快照 * 股票結構參考 Security 限頻接口：30秒內最多10次 最多可傳入200只股票 * @async * @param {Security[]} securityList 股票列表 * @returns {Snapshot[]} snapshotList 股票快照 */ async qotGetSecuritySnapShot(securityList) { // 3203獲取股票快照 const list = [].concat(securityList); let snapshotList = []; while (list.length) { const res = await this.limitExecTimes( 30 * 1000, 10, async () =&gt; { const data = await this.socket.send('Qot_GetSecuritySnapshot', { securityList: list.splice(-200), }); return data.snapshotList; }, ); snapshotList = snapshotList.concat(res); } return snapshotList; } /** * 限制接口調用頻率 * @param {Number} interval 限頻間隔 * @param {Number} times 次數 * @param {Function} fn 要執行的函數 */ async limitExecTimes(interval, times, fn) { const now = Date.now(); const name = `${fn.toString()}_exec_time_array`; const execArray = this[name] || []; while (execArray[0] &amp;&amp; now - execArray[0] &gt; interval) { execArray.shift(); } if (execArray.length &gt; times) { await this.sleep(interval - (now - execArray[0])); } execArray.push(Date.now()); this[name] = execArray; return fn(); } /** * PlateInfo * @typedef PlateInfo * @property {Security} plate 板塊 * @property {string} name 板塊名字 */ /** * Qot_GetPlateSet.proto - 3204獲取板塊集合下的板塊 * @async * @param {QotMarket} market Qot_Common.QotMarket,股票市場 * @param {PlateSetType} plateSetType Qot_Common.PlateSetType,板塊集合的類型 * @returns {PlateInfo[]} 板塊集合下的板塊信息 */ async qotGetPlateSet(market = 1, plateSetType) { // 3204獲取板塊集合下的板塊 return (await this.socket.send('Qot_GetPlateSet', { market, plateSetType, })).plateInfoList || []; } /** * Qot_GetPlateSecurity.proto - 3205獲取板塊下的股票 * @async * @param {Security} plate 板塊 * @returns {SecurityStaticInfo[]} 板塊下的股票靜態信息 */ async qotGetPlateSecurity(plate) { // 3205獲取板塊下的股票 return (await this.socket.send('Qot_GetPlateSecurity', { plate, })).staticInfoList || []; } /** * 股票類型 * ReferenceType_Unknow = 0; ReferenceType_Warrant = 1; //正股相關的窩輪 * @typedef {number} ReferenceType */ /** * Qot_GetReference.proto - 3206 獲取正股相關股票 * @async * @param {security} security 股票 * @param {ReferenceType} [referenceType] 相關類型，默認為1，獲取正股相關的渦輪 */ async qotGetReference(security, referenceType = 1) { return (await this.socket.send('Qot_GetReference', { security, referenceType, })).staticInfoList || []; } /** * Trd_GetAccList.proto - 2001獲取交易賬戶列表 * @async * @returns {TrdAcc[]} 交易業務賬戶列表 */ async trdGetAccList() { // 2001獲取交易賬戶列表 const { accList, } = (await this.socket.send('Trd_GetAccList', { userID: this.userID, })); return accList.filter(acc =&gt; acc.trdMarketAuthList.includes(this.market) &amp;&amp; acc.trdEnv === this.env); } /** * Trd_UnlockTrade.proto - 2005解鎖或鎖定交易 * 除2001協議外，所有交易協議請求都需要FutuOpenD先解鎖交易 密碼MD5方式獲取請參考 FutuOpenD配置 內的login_pwd_md5字段 解鎖或鎖定交易針對與FutuOpenD，只要有一個連接解鎖，其他連接都可以調用交易接口 強烈建議有實盤交易的用戶使用加密通道，參考 加密通信流程 限頻接口：30秒內最多10次 * @param {boolean} [unlock=true] true解鎖交易，false鎖定交易，默認true * @param {string} [pwdMD5] 交易密碼的MD5轉16進制(全小寫)，解鎖交易必須要填密碼，鎖定交易不需要驗證密碼，可不填 * @async */ trdUnlockTrade(unlock = true, pwdMD5 = '') { // 2005解鎖或鎖定交易 if (pwdMD5) this.pwdMD5 = pwdMD5; return this.socket.send('Trd_UnlockTrade', { unlock, pwdMD5: pwdMD5 || this.pwdMD5, }); } /** * Trd_SubAccPush.proto - 2008訂閱接收交易賬戶的推送數據 * @async * @param {number[]} accIDList 要接收推送數據的業務賬號列表，全量非增量，即使用者請每次傳需要接收推送數據的所有業務賬號 */ async trdSubAccPush(accIDList) { // 2008訂閱接收交易賬戶的推送數據 return this.socket.send('Trd_SubAccPush', { accIDList, }); } /** * 設置交易模塊的公共header，調用交易相關接口前必須先調用此接口。 * @param {TrdEnv} trdEnv 交易環境, 參見TrdEnv的枚舉定義。0為仿真，1為真實，默認為1。 * @param {number} accID 業務賬號, 業務賬號與交易環境、市場權限需要匹配，否則會返回錯誤，默認為當前userID * @param {TrdMarket} [trdMarket=1] 交易市場, 參見TrdMarket的枚舉定義，默認為1，即香港市場。 */ setCommonTradeHeader(trdEnv = 1, accID, trdMarket = 1) { // 設置交易模塊的公共header，調用交易相關接口前必須先調用此接口。 this.market = trdMarket; this.trdHeader = { trdEnv, accID, trdMarket, }; } /** * Trd_GetFunds.proto - 2101獲取賬戶資金，需要先設置交易模塊公共header * @returns {Funds} */ async trdGetFunds() { // 2101獲取賬戶資金 if (!this.trdHeader) throw new Error('請先調用setCommonTradeHeader接口設置交易公共header'); return (await this.socket.send('Trd_GetFunds', { header: this.trdHeader, })).funds; } /** * Trd_GetPositionList.proto - 2102獲取持倉列表 * @async * @param {TrdFilterConditions} filterConditions 過濾條件 * @param {number} filterPLRatioMin 過濾盈虧比例下限，高於此比例的會返回，如0.1，返回盈虧比例大於10%的持倉 * @param {number} filterPLRatioMax 過濾盈虧比例上限，低於此比例的會返回，如0.2，返回盈虧比例小於20%的持倉 * @returns {Position[]} 持倉列表數組 */ async trdGetPositionList(filterConditions, filterPLRatioMin, filterPLRatioMax) { // 2102獲取持倉列表 if (!this.trdHeader) throw new Error('請先調用setCommonTradeHeader接口設置交易公共header'); return (await this.socket.send('Trd_GetPositionList', { header: this.trdHeader, // 交易公共參數頭 filterConditions, // 過濾條件 filterPLRatioMin, // 過濾盈虧比例下限，高於此比例的會返回，如0.1，返回盈虧比例大於10%的持倉 filterPLRatioMax, // 過濾盈虧比例上限，低於此比例的會返回，如0.2，返回盈虧比例小於20%的持倉 })).positionList || []; } /** * Trd_GetMaxTrdQtys.proto - 2111獲取最大交易數量 * @param {object} params * @param {TrdHeader} [params.header] 交易公共參數頭，默認不用填寫 * @param {OrderType} params.orderType 訂單類型, 參見Trd_Common.OrderType的枚舉定義 * @param {string} params.code 代碼 * @param {number} [params.price] 價格，3位精度(A股2位) * @param {number} params.orderID 訂單號，新下訂單不需要，如果是修改訂單就需要把原訂單號帶上才行，因為改單的最大買賣數量會包含原訂單數量。 * 以下為調整價格使用，目前僅對港、A股有效，因為港股有價位，A股2位精度，美股不需要 * @param {boolean} [params.adjustPrice] 是否調整價格，如果價格不合法，是否調整到合法價位，true調整，false不調整 * @param {number} [params.adjustSideAndLimit] 調整方向和調整幅度百分比限制，正數代表向上調整，負數代表向下調整，具體值代表調整幅度限制，如：0.015代表向上調整且幅度不超過1.5%；-0.01代表向下調整且幅度不超過1% * @returns {MaxTrdQtys} 最大交易數量結構體 */ async trdGetMaxTrdQtys(params) { if (!this.trdHeader) throw new Error('請先調用setCommonTradeHeader接口設置交易公共header'); return (await this.socket.send('Trd_GetMaxTrdQtys', Object.assign({ header: this.trdHeader, // 交易公共參數頭 orderType: 1, // 訂單類型, 參見Trd_Common.OrderType的枚舉定義 code: '', // 代碼 price: 0, // 價格，3位精度(A股2位) orderID: 0, // 訂單號，新下訂單不需要，如果是修改訂單就需要把原訂單號帶上才行，因為改單的最大買賣數量會包含原訂單數量。 // 以下為調整價格使用，目前僅對港、A股有效，因為港股有價位，A股2位精度，美股不需要 adjustPrice: false, // 是否調整價格，如果價格不合法，是否調整到合法價位，true調整，false不調整 adjustSideAndLimit: 0, // 調整方向和調整幅度百分比限制，正數代表向上調整，負數代表向下調整，具體值代表調整幅度限制，如：0.015代表向上調整且幅度不超過1.5%；-0.01代表向下調整且幅度不超過1% }, params))).maxTrdQtys; } /** * Trd_GetOrderList.proto - 2201獲取訂單列表 * @async * @param {TrdFilterConditions} filterConditions 過濾條件 * @param {OrderStatus[]} filterStatusList 需要過濾的訂單狀態列表 * @returns {Order[]} 訂單列表 */ async trdGetOrderList(filterConditions, filterStatusList) { // 2201獲取訂單列表 if (!this.trdHeader) throw new Error('請先調用setCommonTradeHeader接口設置交易公共header'); return (await this.socket.send('Trd_GetOrderList', { header: this.trdHeader, // 交易公共參數頭 filterConditions, filterStatusList, })).orderList || []; } /** * Trd_PlaceOrder.proto - 2202下單 * 請求包標識結構參考 PacketID 交易公共參數頭結構參考 TrdHeader 交易方向枚舉參考 TrdSide 訂單類型枚舉參考 OrderType 限頻接口：30秒內最多30次 * @async * @param {object} params * @param {PacketID} [params.packetID] 交易寫操作防重放攻擊，默認不用填寫 * @param {TrdHeader} [params.header] 交易公共參數頭，默認不用填寫 * @param {TrdSide} params.trdSide 交易方向, 參見Trd_Common.TrdSide的枚舉定義 * @param {OrderType} params.orderType 訂單類型, 參見Trd_Common.OrderType的枚舉定義 * @param {string} params.code 代碼 * @param {number} params.qty 數量，2位精度，期權單位是&quot;張&quot; * @param {number} [params.price] 價格，3位精度(A股2位) * 以下為調整價格使用，目前僅對港、A股有效，因為港股有價位，A股2位精度，美股不需要 * @param {boolean} [params.adjustPrice] 是否調整價格，如果價格不合法，是否調整到合法價位，true調整，false不調整 * @param {number} [params.adjustSideAndLimit] 調整方向和調整幅度百分比限制，正數代表向上調整，負數代表向下調整，具體值代表調整幅度限制，如：0.015代表向上調整且幅度不超過1.5%；-0.01代表向下調整且幅度不超過1% * @returns {number} orderID 訂單號 */ async trdPlaceOrder(params) { // 2202下單 if (!this.trdHeader) throw new Error('請先調用setCommonTradeHeader接口設置交易公共header'); return (await this.socket.send('Trd_PlaceOrder', Object.assign({ packetID: { connID: this.connID, serialNo: this.socket.requestId, }, // 交易寫操作防重放攻擊 header: this.trdHeader, // 交易公共參數頭 trdSide: 0, // 交易方向，1買入，2賣出 orderType: 1, // 訂單類型, 參見Trd_Common.OrderType的枚舉定義 code: '', // 代碼 qty: 0, // 數量，2位精度，期權單位是&quot;張&quot; price: 0, // 價格，3位精度(A股2位) // 以下為調整價格使用，目前僅對港、A股有效，因為港股有價位，A股2位精度，美股不需要 adjustPrice: false, // 是否調整價格，如果價格不合法，是否調整到合法價位，true調整，false不調整 adjustSideAndLimit: 0, // 調整方向和調整幅度百分比限制，正數代表向上調整，負數代表向下調整，具體值代表調整幅度限制，如：0.015代表向上調整且幅度不超過1.5%；-0.01代表向下調整且幅度不超過1% }, params))).orderID; } /** * 2202市價下單，直到成功為止，返回買入/賣出的總價格 * * @async * @param {object} param * @param {TrdSide} params.trdSide 交易方向, 參見Trd_Common.TrdSide的枚舉定義 * @param {string} params.code 代碼 * @param {number} params.qty 數量，2位精度，期權單位是&quot;張&quot; * @returns {number} 賣出/買入總價 */ async trdPlaceOrderMarket(param) { // 市價買入賣出 const { trdSide, code, qty } = param; // trdSide 1買入2賣出 let remainQty = qty; let value = 0; while (remainQty &gt; 0) { let orderID = null; let order = null; const orderBooks = await this.qotGetOrderBook({ market: this.market, code });// 獲取盤口 const price = trdSide === 1 ? orderBooks.sellList[0].price : orderBooks.buyList[0].price; if (orderID &amp;&amp; order.orderStatus === 10) { await this.trdModifyOrder({// 修改訂單並設置訂單為有效 modifyOrderOp: 4, orderID, price, qty: remainQty, }); } else if (!orderID) { orderID = await this.trdPlaceOrder({ trdSide, code, qty: remainQty, price, }); // 下單 } // eslint-disable-next-line while (true) { // 確認了不傳入過濾條件會返回所有訂單 const list = await this.trdGetOrderList({}, []); // eslint-disable-next-line order = list.filter(item =&gt; item.orderID === orderID); if (order) { if (order.orderStatus &gt; 11) { order = null; orderID = null; break; } else if (order.orderStatus &lt; 10) { await sleep(50); } else if (order.fillQty &gt; 0) { remainQty -= order.fillQty; value += order.price * order.fillQty; if (remainQty &gt; 0 &amp;&amp; order.orderStatus === 10) { // 部分成交，先設置為失效 await this.trdModifyOrder({ modifyOrderOp: 3, orderID }); // 失效 } } } else { await sleep(60); } } } return value; } /** * Trd_ModifyOrder.proto - 2205修改訂單(改價、改量、改狀態等) * 請求包標識結構參考 PacketID 交易公共參數頭結構參考 TrdHeader 修改操作枚舉參考 ModifyOrderOp 限頻接口：30秒內最多30次 * @async * @param {object} params * @param {PacketID} [params.packetID] 交易寫操作防重放攻擊，默認不用填寫 * @param {TrdHeader} [params.header] 交易公共參數頭，默認不用填寫 * @param {number} params.orderID 訂單號，forAll為true時，傳0 * @param {ModifyOrderOp} params.modifyOrderOp 修改操作類型，參見Trd_Common.ModifyOrderOp的枚舉定義 * @param {boolean} [params.forAll] 是否對此業務賬戶的全部訂單操作，true是，false否(對單個訂單)，無此字段代表false，僅對單個訂單 * 下面的字段僅在modifyOrderOp為ModifyOrderOp_Normal有效 * @param {number} [params.qty] 數量，2位精度，期權單位是&quot;張&quot; * @param {number} [params.price] 價格，3位精度(A股2位) * 以下為調整價格使用，目前僅對港、A股有效，因為港股有價位，A股2位精度，美股不需要 * @param {boolean} [params.adjustPrice] 是否調整價格，如果價格不合法，是否調整到合法價位，true調整，false不調整 * @param {number} [params.adjustSideAndLimit] 調整方向和調整幅度百分比限制，正數代表向上調整，負數代表向下調整，具體值代表調整幅度限制，如：0.015代表向上調整且幅度不超過1.5%；-0.01代表向下調整且幅度不超過1% * @returns {number} orderID 訂單號 */ async trdModifyOrder(params) { // 2205修改訂單(改價、改量、改狀態等) if (!this.trdHeader) throw new Error('請先調用setCommonTradeHeader接口設置交易公共header'); return (await this.socket.send('Trd_ModifyOrder', Object.assign({ packetID: { connID: this.connID, serialNo: this.socket.requestId, }, // 交易寫操作防重放攻擊 header: this.trdHeader, // 交易公共參數頭 orderID: 0, // 訂單號，forAll為true時，傳0 modifyOrderOp: 1, // //修改操作類型，參見Trd_Common.ModifyOrderOp的枚舉定義 forAll: false, // /是否對此業務賬戶的全部訂單操作，true是，false否(對單個訂單)，無此字段代表false，僅對單個訂單 qty: 0, // 數量，2位精度，期權單位是&quot;張&quot; price: 0, // 價格，3位精度(A股2位) // 以下為調整價格使用，目前僅對港、A股有效，因為港股有價位，A股2位精度，美股不需要 adjustPrice: false, // 是否調整價格，如果價格不合法，是否調整到合法價位，true調整，false不調整 adjustSideAndLimit: 0, // 調整方向和調整幅度百分比限制，正數代表向上調整，負數代表向下調整，具體值代表調整幅度限制，如：0.015代表向上調整且幅度不超過1.5%；-0.01代表向下調整且幅度不超過1% }, params))).orderID; } /** * 注冊訂單更新通知 * Trd_UpdateOrder.proto - 2208推送訂單更新 * @async * @param {function} callback 回調 * @returns {Order} 訂單結構 */ async subTrdUpdateOrder(callback) { // 注冊訂單更新通知 return this.socket.subNotify(2208, data =&gt; callback(data.order)); } /** * 取消注冊訂單更新通知 * Trd_UpdateOrder.proto - 2208推送訂單更新 * @async */ async unsubTrdUpdateOrder() { // 取消注冊訂單更新通知 return this.socket.unsubNotify(2208); } /** * Trd_GetOrderFillList.proto - 2211獲取成交列表 * @async * @param {TrdFilterConditions} filterConditions 過濾條件 * @returns {OrderFill[]} 成交列表 */ async trdGetOrderFillList(filterConditions) { // 2211獲取成交列表 if (!this.trdHeader) throw new Error('請先調用setCommonTradeHeader接口設置交易公共header'); return (await this.socket.send('Trd_GetOrderFillList', { header: this.trdHeader, // 交易公共參數頭 filterConditions, })).orderFillList || []; } /** * 注冊新成交通知 * Trd_UpdateOrderFill.proto - 2218推送新成交 * @param {function} callback 回調 * @returns {OrderFill} 成交結構 */ async subTrdUpdateOrderFill(callback) { // 注冊新成交通知 return this.socket.subNotify(2218, data =&gt; callback(data.orderFill || [])); } /** * Trd_GetHistoryOrderList.proto - 2221獲取歷史訂單列表 * 交易公共參數頭結構參考 TrdHeader 訂單結構參考 Order 過濾條件結構參考 TrdFilterConditions 訂單狀態枚舉參考 OrderStatus 限頻接口：30秒內最多10次 * @async * @param {TrdFilterConditions} filterConditions 過濾條件 * @param {OrderStatus} filterStatusList OrderStatus, 需要過濾的訂單狀態列表 * @returns {Order[]} 歷史訂單列表 */ async trdGetHistoryOrderList(filterConditions, filterStatusList) { // 2221獲取歷史訂單列表 if (!this.trdHeader) throw new Error('請先調用setCommonTradeHeader接口設置交易公共header'); return (await this.socket.send('Trd_GetHistoryOrderList', { header: this.trdHeader, // 交易公共參數頭 filterConditions, filterStatusList, })).orderList || []; } /** * Trd_GetHistoryOrderFillList.proto - 2222獲取歷史成交列表 * 交易公共參數頭結構參考 TrdHeader 成交結構參考 OrderFill 過濾條件結構參考 TrdFilterConditions 限頻接口：30秒內最多10次 * @async * @param {TrdFilterConditions} filterConditions 過濾條件 * @returns {OrderFill[]} 歷史成交列表 */ async trdGetHistoryOrderFillList(filterConditions) { // 2222獲取歷史成交列表 if (!this.trdHeader) throw new Error('請先調用setCommonTradeHeader接口設置交易公共header'); return (await this.socket.send('Trd_GetHistoryOrderFillList', { header: this.trdHeader, // 交易公共參數頭 filterConditions, })).orderFillList || []; } } module.exports = FutuQuant; × Search results Close Documentation generated by JSDoc 3.5.5 on 2018-08-28T13:24:55+08:00 using the DocStrap template. "},"socket.js.html":{"id":"socket.js.html","title":"Source: socket.js","body":" FutuQuant-Nodejs Classes FutuQuantSocket Global Global Source: socket.js const net = require('net'); const protobufjs = require('protobufjs'); const hexSha1 = require('hex-sha1'); const ProtoId = require('./protoid'); const Pb = require('./pb.json'); const ProtoName = {}; Object.keys(ProtoId).forEach((key) =&gt; { ProtoName[ProtoId[key]] = key; }); let id = 1; /** * Socket模塊 */ class Socket { /** * Creates an instance of Socket. * @param {string} ip OpenD服務Ip * @param {number} port OpenD服務端口 * @param {object} logger 日志對象 */ constructor(ip, port, logger) { /** * OpenD服務IP * @type {string} */ this.ip = ip; /** * OpenD服務端口 * @type {number} */ this.port = port; /** * 日志對象 * @type {object} */ this.logger = logger; id += 1; /** * socket id，自增，用於區分多個socket。 * @type {number} */ this.id = id; /** * socket名稱，用於區分多個socket。 * @type {string} */ this.name = `Socket(${this.id})`; /** * socket是否已經連接 * @type {boolean} */ this.isConnect = false; /** * 請求序列號，自增 * @type {number} */ this.requestId = 1000; // 請求序列號，自增 this.isHandStop = false; this.root = protobufjs.Root.fromJSON(Pb); this.cacheResponseCallback = {}; // 緩存的回調函數 this.cacheNotifyCallback = {}; // 緩存的通知回調函數 this.header = null; // 緩存接收的數據包頭 this.recvBuffer = Buffer.allocUnsafe(0); // 緩存接收的數據 this.socket = new net.Socket(); this.socket.setKeepAlive(true); this.socket.on('error', (data) =&gt; { this.logger.error(`${this.name} on error: ${data}`); this.socket.destroy(); this.isConnect = false; }); this.socket.on('timeout', (e) =&gt; { this.logger.error(`${this.name} on timeout.`, e); this.socket.destroy(); this.isConnect = false; }); // 為客戶端添加「close」事件處理函數 this.socket.on('close', () =&gt; { if (this.isHandStop) return; const errMsg = `${this.name} on closed and retry connect on 5 seconds.`; this.logger.error(errMsg); this.isConnect = false; // 5s後重連 if (this.timerRecontent) return; this.timerRecontent = setTimeout(() =&gt; { this.init(); }, 5000); }); // 接收數據 this.socket.on('data', (data) =&gt; { this.recvBuffer = Buffer.concat([this.recvBuffer, data]); this.parseData(); }); } async init() { if (this.isConnect) return; await this.connect(); } /** * 立即建立連接 */ async connect() { this.isHandStop = false; return new Promise((resolve) =&gt; { if (this.timerRecontent) { clearTimeout(this.timerRecontent); this.timerRecontent = null; } this.socket.connect({ port: this.port, host: this.ip, timeout: 1000 * 30, }, async () =&gt; { this.logger.debug(`${this.name} connect success:${this.ip}:${this.port}`); this.isConnect = true; if (typeof this.connectCallback === 'function') this.connectCallback(); resolve(); }); }); } async close() { this.socket.end(); this.socket.destroy(); this.isHandStop = true; this.logger.info('手動關閉 socket 。'); } /** * 設置連接成功的回調函數 * * @param {function} cb * @memberof Socket */ onConnect(cb) { this.connectCallback = cb; } /** * 注冊協議的通知 * * @param {number} protoId 協議id * @param {function} callback 回調函數 */ subNotify(protoId, callback) { this.cacheNotifyCallback[protoId] = callback; } /** * 刪除一個通知 * @param {number} protoId 協議id */ unsubNotify(protoId) { if (this.cacheNotifyCallback[protoId]) { delete this.cacheNotifyCallback[protoId]; } } /** * 發送數據 * * @async * @param {string} protoName 協議名稱 * @param {object} message 要發送的數據 */ send(protoName, message) { if (!this.isConnect) return this.logger.warn(`${this.name} 尚未連接，無法發送請求。`); const protoId = ProtoId[protoName]; if (!protoId) return this.logger.warn(`找不到對應的協議Id:${protoName}`); // 請求序列號，自增 if (this.requestId &gt; 1000000) this.requestId = 1000; const { requestId } = this; this.requestId += 1; const request = this.root[protoName].Request; const response = this.root[protoName].Response; // 處理請求數據 const reqBuffer = request.encode(request.create({ c2s: message, })).finish(); const sha1 = hexSha1(reqBuffer); const sha1Buffer = new Uint8Array(20).map((item, index) =&gt; Number(`0x${sha1.substr(index * 2, 2)}`)); this.logger.debug(`request:${protoName}(${protoId}),reqId:${requestId}`); // 處理包頭 const buffer = Buffer.concat([ Buffer.from('FT'), // 包頭起始標志，固定為「FT」 Buffer.from(new Uint32Array([protoId]).buffer), // 協議ID Buffer.from(new Uint8Array([0]).buffer), // 協議格式類型，0為Protobuf格式，1為Json格式 Buffer.from(new Uint8Array([0]).buffer), // 協議版本，用於迭代兼容, 目前填0 Buffer.from(new Uint32Array([requestId]).buffer), // 包序列號，用於對應請求包和回包, 要求遞增 Buffer.from(new Uint32Array([reqBuffer.length]).buffer), // 包體長度 Buffer.from(sha1Buffer.buffer), // 包體原始數據(解密後)的SHA1哈希值 Buffer.from(new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]).buffer), // 保留8字節擴展 reqBuffer, ]); // 發送請求，處理回調 this.socket.write(buffer); return new Promise((resolve, reject) =&gt; { this.cacheResponseCallback[requestId] = (responseBuffer) =&gt; { const result = response.decode(responseBuffer).toJSON(); if (result.retType === 0) return resolve(result.s2c); const errMsg = `服務器返回結果失敗,request:${protoName}(${protoId}),retType:${result.retType},reqId:${requestId},errMsg:${result.retMsg}`; this.logger.error(errMsg); return reject(new Error(errMsg)); }; }); } /** * 解析包體數據 */ parseData() { const headerLen = 44; // 包頭長度 let bodyBuffer = null; // 包體buffer let bodyLen = 0; // 包體長度 let reqId = null; // 請求序列號 let protoId = null; // 請求協議Id let bodySha1 = null; // 包體sha1 // 先處理包頭 if (!this.header &amp;&amp; this.recvBuffer.length &gt;= headerLen) { let recvSha1 = new Array(21).join('0').split('').map((item, index) =&gt; { let str = this.recvBuffer.readUInt8(16 + index).toString(16); if (str.length === 1) str = `0${str}`; return str; }); recvSha1 = recvSha1.join(''); this.header = { // 包頭起始標志，固定為「FT」 szHeaderFlag: String.fromCharCode(this.recvBuffer.readUInt8(0)) + String.fromCharCode(this.recvBuffer.readUInt8(1)), nProtoID: this.recvBuffer.readUInt32LE(2), // 協議ID nProtoFmtType: this.recvBuffer.readUInt8(6), // 協議格式類型，0為Protobuf格式，1為Json格式 nProtoVer: this.recvBuffer.readUInt8(7), // 協議版本，用於迭代兼容 nSerialNo: this.recvBuffer.readUInt32LE(8), // 包序列號 nBodyLen: this.recvBuffer.readUInt32LE(12), // 包體長度 arrBodySHA1: recvSha1, // 包體原數據(解密後)的SHA1哈希值 arrReserved: this.recvBuffer.slice(36, 44), // 保留8字節擴展 }; if (this.header.szHeaderFlag !== 'FT') throw new Error('接收的包頭數據格式錯誤'); this.logger.debug(`response:${ProtoName[this.header.nProtoID]}(${this.header.nProtoID}),reqId:${this.header.nSerialNo},bodyLen:${bodyLen}`); } // 已經接收指定包體長度的全部數據，切割包體buffer if (this.header &amp;&amp; this.recvBuffer.length &gt;= this.header.nBodyLen + headerLen) { reqId = this.header.nSerialNo; protoId = this.header.nProtoID; bodyLen = this.header.nBodyLen; bodySha1 = this.header.arrBodySHA1; this.header = null; bodyBuffer = this.recvBuffer.slice(44, bodyLen + headerLen); this.recvBuffer = this.recvBuffer.slice(bodyLen + headerLen); const sha1 = hexSha1(bodyBuffer); if (sha1 !== bodySha1) { throw new Error(`接收的包體sha1加密錯誤：${bodySha1},本地sha1：${sha1}`); } // 交給回調處理包體數據 if (this.cacheResponseCallback[reqId]) { this.cacheResponseCallback[reqId](bodyBuffer); delete this.cacheResponseCallback[reqId]; } // 通知模塊 if (this.cacheNotifyCallback[protoId]) { try { // 加載proto協議文件 const protoName = ProtoName[protoId]; const response = this.root[protoName].Response; const result = response.decode(bodyBuffer).toJSON(); this.cacheNotifyCallback[protoId](result.s2c); } catch (e) { const errMsg = `通知回調執行錯誤，response:${ProtoName[protoId]}(${protoId}),reqId:${reqId},bodyLen:${bodyLen}，堆棧：${e.stack}`; this.logger.error(errMsg); throw new Error(errMsg); } } if (this.recvBuffer.length &gt; headerLen) this.parseData(); } } } module.exports = Socket; × Search results Close Documentation generated by JSDoc 3.5.5 on 2018-08-28T13:24:55+08:00 using the DocStrap template. "},"global.html":{"id":"global.html","title":"Global","body":" FutuQuant-Nodejs Classes FutuQuantSocket Global Global Global Type Definitions BasicQot 基礎報價 Type: object Properties: Name Type Description security security 股票 isSuspended boolean 是否停牌 listTime string 上市日期字符串 priceSpread number 價差 updateTime string 更新時間字符串 highPrice number 最高價 openPrice number 開盤價 lowPrice number 最低價 curPrice number 最新價 lastClosePrice number 昨收價 volume number 成交量 turnover number 成交額 turnoverRate number 換手率 amplitude number 振幅 Source: typedef.js, line 194 Broker 買賣經紀擺盤 Type: object Properties: Name Type Description id number 經紀ID name string 經紀名稱 pos number 經紀檔位 Source: typedef.js, line 246 CompanyAct 公司行動組合,指定某些字段值是否有效 CompanyAct_None = 0; //無 CompanyAct_Split = 1; //拆股 CompanyAct_Join = 2; //合股 CompanyAct_Bonus = 4; //送股 CompanyAct_Transfer = 8; //轉贈股 CompanyAct_Allot = 16; //配股 CompanyAct_Add = 32; //增發股 CompanyAct_Dividend = 64; //現金分紅 CompanyAct_SPDividend = 128; //特別股息 Type: number Source: futuquant.js, line 534 ConnSubInfo 單條連接定閱信息 一條連接重復定閱其它連接已經訂閱過的，不會額外消耗訂閱額度 Properties: Name Type Description subInfoList Array.&lt;SubInfo&gt; 該連接訂閱信息 usedQuota number 該連接已經使用的訂閱額度 isOwnConnData boolean 用於區分是否是自己連接的數據 Source: typedef.js, line 277 DataStatus 這個時間點返回數據的狀態以及來源 DataStatus_Null = 0; //空數據 DataStatus_Current = 1; //當前時間點數據 DataStatus_Previous = 2; //前一個時間點數據 DataStatus_Back = 3; //後一個時間點數據 Type: number Source: futuquant.js, line 479 EquitySnapshotExData 正股類型額外數據 Properties: Name Type Description issuedShares number 發行股本,即總股本 issuedMarketVal number 總市值 =總股本*當前價格 netAsset number 資產淨值 netProfit number 盈利（虧損） earningsPershare number 每股盈利 outstandingShares number 流通股本 outstandingMarketVal number 流通市值 =流通股本*當前價格 netAssetPershare number 每股淨資產 eyRate number 收益率 peRate number 市盈率 pbRate number 市淨率 Source: futuquant.js, line 627 Funds 賬戶資金結構 Type: object Properties: Name Type Description power number 購買力，3位精度(A股2位)，下同 totalAssets number 資產淨值 cash number 現金 marketVal number 證券市值 frozenCash number 凍結金額 debtCash number 欠款金額 avlWithdrawalCash number 可提金額 Source: typedef.js, line 388 GetGlobalStateResponse GetGlobalState.proto協議返回對象 Properties: Name Type Description marketHK QotMarketState Qot_Common.QotMarketState,港股主板市場狀態 marketUS QotMarketState Qot_Common.QotMarketState,美股Nasdaq市場狀態 marketSH QotMarketState Qot_Common.QotMarketState,滬市狀態 marketSZ QotMarketState Qot_Common.QotMarketState,深市狀態 marketHKFuture QotMarketState Qot_Common.QotMarketState,港股期貨市場狀態 qotLogined boolean 是否登陸行情服務器 trdLogined boolean 是否登陸交易服務器 serverVer number 版本號 serverBuildNo number buildNo time number 當前格林威治時間 Source: futuquant.js, line 140 HistoryPointsKL K線數據 Properties: Name Type Description status DataStatus DataStatus,數據狀態 reqTime string 請求的時間 kl KLine K線數據 Source: futuquant.js, line 488 InitConnectResponse 初始化連接，InitConnect.proto協議返回對象 Properties: Name Type Description serverVer number FutuOpenD的版本號 loginUserID number FutuOpenD登陸的牛牛用戶ID connID number 此連接的連接ID，連接的唯一標識 connAESKey string 此連接後續AES加密通信的Key，固定為16字節長字符串 keepAliveInterval number 心跳保活間隔 Source: futuquant.js, line 84 KLFields 指定返回K線結構體特定某幾項數據，KLFields枚舉值或組合，如果未指定返回全部字段 KLFields_None = 0; // KLFields_High = 1; //最高價 KLFields_Open = 2; //開盤價 KLFields_Low = 4; //最低價 KLFields_Close = 8; //收盤價 KLFields_LastClose = 16; //昨收價 KLFields_Volume = 32; //成交量 KLFields_Turnover = 64; //成交額 KLFields_TurnoverRate = 128; //換手率 KLFields_PE = 256; //市盈率 KLFields_ChangeRate = 512; //漲跌幅 Type: number Source: typedef.js, line 125 KLine K線數據點 Type: object Properties: Name Type Argument Description time string 時間戳字符串 isBlank boolean 是否是空內容的點,若為ture則只有時間信息 highPrice number &lt;optional&gt; 最高價 openPrice number &lt;optional&gt; 開盤價 lowPrice number &lt;optional&gt; 最低價 closePrice number &lt;optional&gt; 收盤價 lastClosePrice number &lt;optional&gt; 昨收價 volume number &lt;optional&gt; 成交量 turnover number &lt;optional&gt; 成交額 turnoverRate number &lt;optional&gt; 換手率 pe number &lt;optional&gt; 市盈率 changeRate number &lt;optional&gt; 漲跌幅 Source: typedef.js, line 178 KLType K線類型，枚舉值兼容舊協議定義，新類型季K,年K,3分K暫時沒有支持歷史K線 KLType_Unknown = 0; //未知 KLType_1Min = 1; //1分K KLType_Day = 2; //日K KLType_Week = 3; //周K KLType_Month = 4; //月K KLType_Year = 5; //年K KLType_5Min = 6; //5分K KLType_15Min = 7; //15分K KLType_30Min = 8; //30分K KLType_60Min = 9; //60分K KLType_3Min = 10; //3分K KLType_Quarter = 11; //季K Type: number Source: typedef.js, line 108 MaxTrdQtys 因目前服務器實現的問題，賣空需要先賣掉持倉才能再賣空，是分開兩步賣的，買回來同樣是逆向兩步；而看多的買是可以現金加融資一起一步買的，請注意這個差異 Type: object Properties: Name Type Argument Description maxCashBuy number 不使用融資，僅自己的現金最大可買整手股數 maxCashAndMarginBuy number &lt;optional&gt; 使用融資，自己的現金 + 融資資金總共的最大可買整手股數 maxPositionSell number 不使用融券(賣空)，僅自己的持倉最大可賣整手股數 maxSellShort number &lt;optional&gt; 使用融券(賣空)，最大可賣空整手股數，不包括多倉 maxBuyBack number &lt;optional&gt; 賣空後，需要買回的最大整手股數。因為賣空後，必須先買回已賣空的股數，還掉股票，才能再繼續買多。 Source: typedef.js, line 454 ModifyOrderOp 修改訂單的操作類型，港股支持全部操作，美股目前僅支持ModifyOrderOp_Normal和ModifyOrderOp_Cancel ModifyOrderOp_Unknown = 0; //未知操作 ModifyOrderOp_Normal = 1; //修改訂單的價格、數量等，即以前的改單 ModifyOrderOp_Cancel = 2; //撤單 ModifyOrderOp_Disable = 3; //失效 ModifyOrderOp_Enable = 4; //生效 ModifyOrderOp_Delete = 5; //刪除 Type: number Source: typedef.js, line 355 NoDataMode 當請求時間點數據為空時，如何返回數據 NoDataMode_Null = 0; //直接返回空數據 NoDataMode_Forward = 1; //往前取值，返回前一個時間點數據 NoDataMode_Backward = 2; //向後取值，返回後一個時間點數據 Type: number Source: futuquant.js, line 471 Order 訂單結構 Type: object Properties: Name Type Argument Description trdSide TrdSide 交易方向, 參見TrdSide的枚舉定義 orderType OrderType 訂單類型, 參見OrderType的枚舉定義 orderStatus OrderStatus 訂單狀態, 參見OrderStatus的枚舉定義 orderID number 訂單號 orderIDEx string 擴展訂單號 code string 代碼 name string 名稱 qty number 訂單數量，2位精度，期權單位是&quot;張&quot; price number &lt;optional&gt; 訂單價格，3位精度(A股2位) createTime string 創建時間，嚴格按YYYY-MM-DD HH:MM:SS或YYYY-MM-DD HH:MM:SS.MS格式傳 updateTime string 最後更新時間，嚴格按YYYY-MM-DD HH:MM:SS或YYYY-MM-DD HH:MM:SS.MS格式傳 fillQty number &lt;optional&gt; 成交數量，2位精度，期權單位是&quot;張&quot; fillAvgPrice number &lt;optional&gt; 成交均價，無精度限制 lastErrMsg string &lt;optional&gt; 最後的錯誤描述，如果有錯誤，會有此描述最後一次錯誤的原因，無錯誤為空 Source: typedef.js, line 420 OrderBook 買賣十檔擺盤 Type: object Properties: Name Type Description price number 委托價格 volume number 委托數量 orederCount number 委托訂單個數 Source: typedef.js, line 264 OrderFill 成交結構 Type: object Properties: Name Type Argument Description trdSide number 交易方向, 參見TrdSide的枚舉定義 fillID number 成交號 fillIDEx string 擴展成交號 orderID number &lt;optional&gt; 訂單號 orderIDEx string &lt;optional&gt; 擴展訂單號 code string 代碼 name string 名稱 qty number 訂單數量，2位精度，期權單位是&quot;張&quot; price number 訂單價格，3位精度(A股2位) createTime string 創建時間（成交時間），嚴格按YYYY-MM-DD HH:MM:SS或YYYY-MM-DD HH:MM:SS.MS格式傳 counterBrokerID number &lt;optional&gt; 對手經紀號，港股有效 counterBrokerName string &lt;optional&gt; 對手經紀名稱，港股有效 Source: typedef.js, line 438 OrderStatus 訂單狀態 OrderStatus_Unsubmitted = 0; //未提交 OrderStatus_Unknown = -1; //未知狀態 OrderStatus_WaitingSubmit = 1; //等待提交 OrderStatus_Submitting = 2; //提交中 OrderStatus_SubmitFailed = 3; //提交失敗，下單失敗 OrderStatus_TimeOut = 4; //處理超時，結果未知 OrderStatus_Submitted = 5; //已提交，等待成交 OrderStatus_Filled_Part = 10; //部分成交 OrderStatus_Filled_All = 11; //全部已成 OrderStatus_Cancelling_Part = 12; //正在撤單_部分(部分已成交，正在撤銷剩余部分) OrderStatus_Cancelling_All = 13; //正在撤單_全部 OrderStatus_Cancelled_Part = 14; //部分成交，剩余部分已撤單 OrderStatus_Cancelled_All = 15; //全部已撤單，無成交 OrderStatus_Failed = 21; //下單失敗，服務拒絕 OrderStatus_Disabled = 22; //已失效 OrderStatus_Deleted = 23; //已刪除，無成交的訂單才能刪除 Type: number Source: typedef.js, line 326 OrderType 訂單類型 OrderType_Unknown = 0; //未知類型 OrderType_Normal = 1; //普通訂單(港股的增強限價單、A股的限價委托、美股的限價單) OrderType_Market = 2; //市價訂單(目前僅美股) OrderType_AbsoluteLimit = 5; //絕對限價訂單(目前僅港股)，只有價格完全匹配才成交，比如你下價格為5元的買單，賣單價格必須也要是5元才能成交，低於5元也不能成交。賣出同理 OrderType_Auction = 6; //競價訂單(目前僅港股)，A股的早盤競價訂單類型不變還是OrderType_Normal OrderType_AuctionLimit = 7; //競價限價訂單(目前僅港股) OrderType_SpecialLimit = 8; //特別限價訂單(目前僅港股)，成交規則同OrderType_AbsoluteLimit，且如果當前沒有對手可成交，不能立即成交，交易所自動撤銷訂單 Type: number Source: typedef.js, line 314 PacketID 請求包標識，包的唯一標識，用於回放攻擊的識別和保護 PacketID 用於唯一標識一次請求 serailNO 由請求方自定義填入包頭，為防回放攻擊要求自增，否則新的請求將被忽略 Type: object Properties: Name Type Description connID number 當前TCP連接的連接ID，一條連接的唯一標識，InitConnect協議會返回 serialNo number 包頭中的包自增序列號 Source: typedef.js, line 14 PlateInfo PlateInfo Properties: Name Type Description plate Security 板塊 name string 板塊名字 Source: futuquant.js, line 732 PlateSetType 板塊集合的類型 Qot_GetPlateSet 請求參數類型 PlateSetType_All = 0; //所有板塊 PlateSetType_Industry = 1; //行業板塊 PlateSetType_Region = 2; //地域板塊,港美股市場的地域分類數據暫為空 PlateSetType_Concept = 3; //概念板塊 Type: number Source: typedef.js, line 56 Position 賬戶持倉結構 Type: object Properties: Name Type Argument Description positionID number 持倉ID，一條持倉的唯一標識 positionSide PositionSide 持倉方向，參見PositionSide的枚舉定義 code string 代碼 name string 名稱 qty number 持有數量，2位精度，期權單位是&quot;張&quot;，下同 canSellQty number 可賣數量 price number 市價，3位精度(A股2位) costPrice number &lt;optional&gt; 成本價，無精度限制，如果沒傳，代表此時此值無效 val number 市值，3位精度(A股2位) plVal number 盈虧金額，3位精度(A股2位) plRatio number &lt;optional&gt; 盈虧比例，無精度限制，如果沒傳，代表此時此值無效 td_plVal number &lt;optional&gt; 今日盈虧金額，3位精度(A股2位)，下同 td_trdVal number &lt;optional&gt; 今日交易額 td_buyVal number &lt;optional&gt; 今日買入總額 td_buyQty number &lt;optional&gt; 今日買入總量 td_sellVal number &lt;optional&gt; 今日賣出總額 td_sellQty number &lt;optional&gt; 今日賣出總量 Source: typedef.js, line 399 PositionSide 持倉方向類型 PositionSide_Long = 0; //多倉，默認情況是多倉 PositionSide_Unknown = -1; //未知方向 PositionSide_Short = 1; //空倉 Type: number Source: typedef.js, line 347 QotGetBrokerResponse Qot_GetBroker.proto協議返回對象 Properties: Name Type Description security Security 股票 brokerAskList Array.&lt;Broker&gt; 經紀Ask(賣)盤 sellList Array.&lt;Broker&gt; 經紀Ask(賣)盤，同brokerAskList brokerBidList Array.&lt;Broker&gt; 經紀Bid(買)盤 buyList Array.&lt;Broker&gt; 經紀Bid(買)盤，同brokerBidList Source: futuquant.js, line 406 QotGetOrderBookResponse Qot_GetOrderBook.proto協議返回對象 Properties: Name Type Description security Security 股票 orderBookAskList Array.&lt;OrderBook&gt; 賣盤 sellList Array.&lt;OrderBook&gt; 賣盤，同orderBookAskList orderBookBidList Array.&lt;OrderBook&gt; 買盤 buyList Array.&lt;OrderBook&gt; 買盤，同orderBookBidList Source: futuquant.js, line 361 QotGetSubInfoResponse Qot_GetSubInfo.proto協議返回對象 Properties: Name Type Description connSubInfoList Array.&lt;ConnSubInfo&gt; 訂閱信息 totalUsedQuota number FutuOpenD已使用的訂閱額度 remainQuota number FutuOpenD剩余訂閱額度 Source: futuquant.js, line 225 QotMarket 行情市場 QotMarket定義一支證券所屬的行情市場分類 QotMarket_HK_Future 港股期貨，目前僅支持 999010(恆指當月期貨)、999011(恆指下月期貨) QotMarket_US_Option 美股期權，牛牛客戶端可以查看行情，API 後續支持 QotMarket_Unknown = 0; //未知市場 QotMarket_HK_Security = 1; //港股 QotMarket_HK_Future = 2; //港期貨(目前是恆指的當月、下月期貨行情) QotMarket_US_Security = 11; //美股 QotMarket_US_Option = 12; //美期權,暫時不支持期權 QotMarket_CNSH_Security = 21; //滬股 QotMarket_CNSZ_Security = 22; //深股 Type: number Source: typedef.js, line 24 QotMarketState 行情市場狀態 QotMarketState_None = 0; // 無交易,美股未開盤 QotMarketState_Auction = 1; // 競價 QotMarketState_WaitingOpen = 2; // 早盤前等待開盤 QotMarketState_Morning = 3; // 早盤 QotMarketState_Rest = 4; // 午間休市 QotMarketState_Afternoon = 5; // 午盤 QotMarketState_Closed = 6; // 收盤 QotMarketState_PreMarketBegin = 8; // 盤前 QotMarketState_PreMarketEnd = 9; // 盤前結束 QotMarketState_AfterHoursBegin = 10; // 盤後 QotMarketState_AfterHoursEnd = 11; // 盤後結束 QotMarketState_NightOpen = 13; // 夜市開盤 QotMarketState_NightEnd = 14; // 夜市收盤 QotMarketState_FutureDayOpen = 15; // 期指日市開盤 QotMarketState_FutureDayBreak = 16; // 期指日市休市 QotMarketState_FutureDayClose = 17; // 期指日市收盤 QotMarketState_FutureDayWaitForOpen = 18; // 期指日市等待開盤 QotMarketState_HkCas = 19; // 盤後競價,港股市場增加CAS機制對應的市場狀態 Type: number Source: typedef.js, line 77 QotUpdateKLResponse Qot_UpdateKL.proto協議返回對象 Properties: Name Type Description rehabType RehabType Qot_Common.RehabType,復權類型 klType KLType Qot_Common.KLType,K線類型 security Security 股票 klList Array.&lt;KLine&gt; 推送的k線點 Source: futuquant.js, line 291 ReconfirmOrderReason 需要再次確認訂單的原因枚舉 ReconfirmOrderReason_Unknown = 0; //未知原因 ReconfirmOrderReason_QtyTooLarge = 1; //訂單數量太大，確認繼續下單並否拆分成多個小訂單 ReconfirmOrderReason_PriceAbnormal = 2; //價格異常，偏離當前價太大，確認繼續下單 Type: number Source: typedef.js, line 366 ReferenceType 股票類型 ReferenceType_Unknow = 0; ReferenceType_Warrant = 1; //正股相關的窩輪 Type: number Source: futuquant.js, line 762 Rehab 復權信息 Properties: Name Type Argument Description time string 時間字符串 companyActFlag CompanyAct 公司行動組合,指定某些字段值是否有效 fwdFactorA number 前復權因子A fwdFactorB number 前復權因子B bwdFactorA number 後復權因子A bwdFactorB number 後復權因子B splitBase number &lt;optional&gt; 拆股(eg.1拆5，Base為1，Ert為5) splitErt number &lt;optional&gt; joinBase number &lt;optional&gt; 合股(eg.50合1，Base為50，Ert為1) joinErt number &lt;optional&gt; bonusBase number &lt;optional&gt; 送股(eg.10送3, Base為10,Ert為3) bonusErt number &lt;optional&gt; transferBase number &lt;optional&gt; 轉贈股(eg.10轉3, Base為10,Ert為3) transferErt number &lt;optional&gt; allotBase number &lt;optional&gt; 配股(eg.10送2, 配股價為6.3元, Base為10, Ert為2, Price為6.3) allotErt number &lt;optional&gt; allotPrice number &lt;optional&gt; addBase number &lt;optional&gt; 增發股(eg.10送2, 增發股價為6.3元, Base為10, Ert為2, Price為6.3) addErt number &lt;optional&gt; addPrice number &lt;optional&gt; dividend number &lt;optional&gt; 現金分紅(eg.每10股派現0.5元,則該字段值為0.05) spDividend number &lt;optional&gt; 特別股息(eg.每10股派特別股息0.5元,則該字段值為0.05) Source: futuquant.js, line 548 RehabType 復權類型 RehabType_None = 0; //不復權 RehabType_Forward = 1; //前復權 RehabType_Backward = 2; //後復權 Type: number Source: typedef.js, line 100 RetType 協議返回值 RetType 定義協議請求返回值 請求失敗情況，除網絡超時外，其它具體原因參見各協議定義的retMsg字段 RetType_Succeed = 0; //成功 RetType_Failed = -1; //失敗 RetType_TimeOut = -100; //超時 RetType_Unknown = -400; //未知結果 Type: number Source: typedef.js, line 2 Security 股票，兩個字段確定一支股票 Type: object Properties: Name Type Description market QotMarket QotMarket,股票市場 code string 股票代碼 Source: typedef.js, line 172 SecurityHistoryKLPoints 多只股票的多點歷史K線點 Properties: Name Type Description security Security 股票 klList HistoryPointsKL K線數據 Source: futuquant.js, line 496 SecurityRehab 股票復權信息 Properties: Name Type Description security Security 股票 rehabList Array.&lt;Rehab&gt; 復權信息 Source: futuquant.js, line 575 SecurityStaticBasic 證券基本靜態信息 Type: object Properties: Name Type Description security security 股票 id number 股票ID lotSize number 每手數量 secType SecurityType Qot_Common.SecurityType,股票類型 name string 股票名字 listTime string 上市時間字符串 Source: typedef.js, line 224 SecurityStaticInfo 證券靜態信息 Type: object Properties: Name Type Argument Description basic SecurityStaticBasic 基本股票靜態信息 warrantExData WarrantStaticExData &lt;optional&gt; 窩輪額外股票靜態信息 Source: typedef.js, line 240 SecurityType 股票類型 SecurityType_Unknown = 0; //未知 SecurityType_Bond = 1; //債券 SecurityType_Bwrt = 2; //一攬子權證 SecurityType_Eqty = 3; //正股 SecurityType_Trust = 4; //信托,基金 SecurityType_Warrant = 5; //渦輪 SecurityType_Index = 6; //指數 SecurityType_Plate = 7; //板塊 SecurityType_Drvt = 8; //期權 SecurityType_PlateSet = 9; //板塊集 Type: number Source: typedef.js, line 41 Snapshot 快照 Properties: Name Type Argument Description basic SnapshotBasicData 快照基本數據 equityExData EquitySnapshotExData &lt;optional&gt; 正股快照額外數據 warrantExData WarrantSnapshotExData &lt;optional&gt; 窩輪快照額外數據 Source: futuquant.js, line 678 SnapshotBasicData 基本快照數據 Properties: Name Type Description security Security 股票 type SecurityType Qot_Common.SecurityType,股票類型 isSuspend boolean 是否停牌 listTime string 上市時間字符串 lotSize number 每手數量 priceSpread number 價差 updateTime string 更新時間字符串 highPrice number 最新價 openPrice number 開盤價 lowPrice number 最低價 lastClosePrice number 昨收價 curPrice number 最新價 volume number 成交量 turnover number 成交額 turnoverRate number 換手率 Source: futuquant.js, line 659 SubInfo 單個定閱類型信息 Type: object Properties: Name Type Description subType SubType Qot_Common.SubType,訂閱類型 securityList Array.&lt;Security&gt; 訂閱該類型行情的股票 Source: typedef.js, line 271 subQotUpdateTickerResponse Qot_GetTicker.proto協議返回對象 Properties: Name Type Description security Security 股票 tickerList Array.&lt;Ticker&gt; 逐筆 Source: futuquant.js, line 345 SubType 行情定閱類型，訂閱類型，枚舉值兼容舊協議定義 SubType_None = 0; SubType_Basic = 1; //基礎報價 SubType_OrderBook = 2; //擺盤 SubType_Ticker = 4; //逐筆 SubType_RT = 5; //分時 SubType_KL_Day = 6; //日K SubType_KL_5Min = 7; //5分K SubType_KL_15Min = 8; //15分K SubType_KL_30Min = 9; //30分K SubType_KL_60Min = 10; //60分K SubType_KL_1Min = 11; //1分K SubType_KL_Week = 12; //周K SubType_KL_Month = 13; //月K SubType_Broker = 14; //經紀隊列 SubType_KL_Qurater = 15; //季K SubType_KL_Year = 16; //年K SubType_KL_3Min = 17; //3分K Type: number Source: typedef.js, line 141 Ticker 逐筆成交 Type: object Properties: Name Type Argument Description time string 時間字符串 sequence number 唯一標識 dir TickerDirection TickerDirection, 買賣方向 price number 價格 volume number 成交量 turnover number 成交額 recvTime number &lt;optional&gt; 收到推送數據的本地時間戳，用於定位延遲 Source: typedef.js, line 253 TickerDirection 逐筆方向 TickerDirection_Unknown = 0; //未知 TickerDirection_Bid = 1; //外盤 TickerDirection_Ask = 2; //內盤 TickerDirection_Neutral = 3; //中性盤 Type: number Source: typedef.js, line 163 TimeShare 分時數據點 Type: object Properties: Name Type Argument Description time string 時間字符串 minute number 距離0點過了多少分鐘 isBlank boolean 是否是空內容的點,若為ture則只有時間信息 price number &lt;optional&gt; 當前價 lastClosePrice number &lt;optional&gt; 昨收價 avgPrice number &lt;optional&gt; 均價 volume number &lt;optional&gt; 成交量 turnover number &lt;optional&gt; 成交額 Source: typedef.js, line 212 TradeDate TradeDate Properties: Name Type Description time string 時間字符串 Source: futuquant.js, line 593 TrdAcc 交易業務賬戶結構 Type: object Properties: Name Type Description trdEnv TrdEnv 交易環境, 參見TrdEnv的枚舉定義 accID number 業務賬號, 業務賬號與交易環境、市場權限需要匹配，否則會返回錯誤 trdMarketAuthList TrdMarket 業務賬戶支持的交易市場權限，即此賬戶能交易那些市場, 可擁有多個交易市場權限，目前僅單個，取值參見TrdMarket的枚舉定義 Source: typedef.js, line 381 TrdEnv 交易環境 TrdEnv_Simulate = 0; //仿真環境(模擬環境) TrdEnv_Real = 1; //真實環境 Type: number Source: typedef.js, line 287 TrdFilterConditions 過濾條件，條件組合是&quot;與&quot;不是&quot;或&quot;，用於獲取訂單、成交、持倉等時二次過濾 Type: object Properties: Name Type Argument Description codeList Array.&lt;string&gt; 代碼過濾，只返回包含這些代碼的數據，沒傳不過濾 idList Array.&lt;number&gt; ID主鍵過濾，只返回包含這些ID的數據，沒傳不過濾，訂單是orderID、成交是fillID、持倉是positionID beginTime string &lt;optional&gt; 開始時間，嚴格按YYYY-MM-DD HH:MM:SS或YYYY-MM-DD HH:MM:SS.MS格式傳，對持倉無效，拉歷史數據必須填 endTime string &lt;optional&gt; 結束時間，嚴格按YYYY-MM-DD HH:MM:SS或YYYY-MM-DD HH:MM:SS.MS格式傳，對持倉無效，拉歷史數據必須填 Source: typedef.js, line 464 TrdHeader 交易協議公共參數頭 Type: object Properties: Name Type Description trdEnv TrdEnv 交易環境, 參見TrdEnv的枚舉定義 accID number 業務賬號, 業務賬號與交易環境、市場權限需要匹配，否則會返回錯誤 trdMarket TrdMarket 交易市場, 參見TrdMarket的枚舉定義 Source: typedef.js, line 374 TrdMarket 交易市場，是大的市場，不是具體品種 TrdMarket_Unknown = 0; //未知市場 TrdMarket_HK = 1; //香港市場 TrdMarket_US = 2; //美國市場 TrdMarket_CN = 3; //大陸市場 TrdMarket_HKCC = 4; //香港A股通市場 Type: number Source: typedef.js, line 294 TrdSide 交易方向，客戶端下單只傳Buy或Sell即可，SellShort是服務器返回有此方向，BuyBack目前不存在，但也不排除服務器會傳 TrdSide_Unknown = 0; //未知方向 TrdSide_Buy = 1; //買入 TrdSide_Sell = 2; //賣出 TrdSide_SellShort = 3; //賣空 TrdSide_BuyBack = 4; //買回 Type: number Source: typedef.js, line 304 WarrantSnapshotExData 渦輪類型額外數據 Properties: Name Type Description conversionRate number 換股比率 warrantType WarrantType Qot_Common.WarrantType,渦輪類型 strikePrice number 行使價 maturityTime string 到期日時間字符串 endTradeTime string 最後交易日時間字符串 owner Security 所屬正股 recoveryPrice number 回收價 streetVolumn number 街貨量 issueVolumn number 發行量 streetRate number 街貨佔比 delta number 對沖值 impliedVolatility number 引申波幅 premium number 溢價 Source: futuquant.js, line 642 WarrantStaticExData 窩輪額外股票靜態信息 Type: object Properties: Name Type Description type WarrantType Qot_Common.WarrantType,渦輪類型 owner Security 所屬正股 Source: typedef.js, line 234 WarrantType 窩輪子類型 WarrantType_Unknown = 0; //未知 WarrantType_Buy = 1; //認購 WarrantType_Sell = 2; //認沽 WarrantType_Bull = 3; //牛 WarrantType_Bear = 4; //熊 Type: number Source: typedef.js, line 67 × Search results Close Documentation generated by JSDoc 3.5.5 on 2018-08-28T13:24:55+08:00 using the DocStrap template. "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" FutuQuant-Nodejs Classes FutuQuantSocket Global Global Classes Classes FutuQuant Socket × Search results Close Documentation generated by JSDoc 3.5.5 on 2018-08-28T13:24:55+08:00 using the DocStrap template. "},"index.html":{"id":"index.html","title":"Index","body":" FutuQuant-Nodejs Classes FutuQuantSocket Global Global FutuQuant量化接口Nodejs版本說明基於 FutuQuant v3.2 底層協議封裝的 nodejs 版本接口，數據格式使用 protobuf，使用前請先在本地或者服務端啟動 FutuOpenD 服務。 使用了async/await語法，要求nodejs版本v7.10.1以上，v7.5.1以上可以使用--harmony或者--harmony-async-await參數開啟async/await的支持，v7.6.x 以可以不用開啟 flag 直接使用。。 底層協議基於FutuQuant v3.2，參考：FutunnOpen/futuquant。 數據傳輸格式目前只支持 protobuf。 API文檔相關：https://yisbug.github.io/nodejs-for-FutuOpenD/doc/index.html 為了方便使用，請注意部分接口參數及返回結果和富途官方版本不完全一致，詳細請參考API文檔。 安裝npm install futuquant --save或者 yarn add futuquant使用/** - **所有行情相關協議獲取數據都需要先通過（1005）協議訂閱成功後才能查詢** - **訂閱的上限為500個訂閱單位。一只股票的一個K線類型佔2個訂閱單位、分時佔2個訂閱單位、 - 報價佔1個訂閱單位、擺盤佔5個訂閱單位（牛熊為1）、逐筆佔5個訂閱單位（牛熊為1）、經紀隊列佔5個訂閱單位（牛熊為1）。** - **反訂閱（1006）的時間限制為１分鐘，即訂閱某支股票某個訂閱位１分鐘之後才能反訂閱** - **30秒內不能超過20次交易請求。** - **建議所有行情拉取接口在同一條長連接上。推送數據在第二條長連接上。交易接口在第三條長連接上。** */ const fs = require('fs'); const path = require('path'); const FtQuant = require('./src/futuquant'); // 自定義日志對象 const bunyan = require('bunyan'); const bunyanDebugStream = require('bunyan-debug-stream'); const bunyanLogger = bunyan.createLogger({ name: 'sys', streams: [{ level: 'debug', type: 'raw', serializers: bunyanDebugStream.serializers, stream: bunyanDebugStream({ forceColor: true }), }], }); // 從 opend 的配置文件中獲取 userID，pwd const FutuOpenDXMLPath = path.join(__dirname, '../FutuOpenD_1.01_Mac/FutuOpenD.xml'); const ftOpenDConfig = fs.readFileSync(FutuOpenDXMLPath); const userID = ftOpenDConfig.match(/login_account&gt;(\\d*?)&lt;\\/login_account/)[1]; const pwdMd5 = ftOpenDConfig.match(/trade_pwd_md5&gt;(.*?)&lt;\\/trade_pwd_md5/)[1]; // openD 配置 const ftConfig = { ip: '127.0.0.1', port: 11111, userID, market: 1, // 港股環境 pwdMd5, env: 1, // 0為仿真，1為真實，默認為1。 }; const ft = new FtQuant(ftConfig, bunyanLogger); const init = async () =&gt; { await ft.init(); // 初始化 ft 模塊，包括調用initConnect、解鎖交易接口、設置 TradeHeader let res = null; res = await ft.getGlobalState(); // 獲取全局狀態 console.log('getGlobalState', res); // 獲取歷史成交記錄，不再需要手動解鎖交易密碼以及調用setCommonTradeHeader await ft.trdGetHistoryOrderFillList({ beginTime: '2018-01-01 00:00:00', endTime: '2018-02-01 00:00:00', }); }; init();測試請先修改test/futuquant.test.js中FutuOpenDXMLPath的路徑，然後執行npm install或yarn安裝相關依賴。 運行測試： npm test廣告如有需要，請填寫推薦人牛牛號：5894668，謝謝！ 更新最新更新最新更新 log 不再同步到 readme.md ，詳情請點擊查看更新日志 3.2.0 - 2018-8-15 opt: 修改版本號和官方 futuquant 的大版本號一致，即前兩位3.2和官方保持一致，小版本號的更新用於bugfix 和其他的接口調整。 opt: 徹底去除 es6 modules，不再需要 babel 編譯。 feat: 同步更新到官方最新版本 v3.2 。 feat: 增加 qotGetReference 獲取正股相關股票接口 feat: 增加 trdGetMaxTrdQtys 獲取最大交易數量接口 fix: 獲取 k 線相關接口返回的數組增加兼容性支持。 feat: qotGetHistoryKLPoints 接口返回參數調整為直接返回數組 feat: qotGetTicker 接口返回參數調整為直接返回數組 feat: qotGetRT 接口返回參數調整為直接返回數組 0.2.0 - 2018.07.27 fix: 優化自定義logger部分 feat: 修改qotGetBasicQot方法直接返回數組 feat: 修改qotGetOrderBook方法直接返回對象，並增加sellList和buyList兩個字段，等同於orderBookAskList和orderBookBidList feat: 修改subQotUpdateOrderBook事件傳遞的擺盤結果，增加sellList和buyList兩個字段，等同於orderBookAskList和orderBookBidList feat: 修改qotGetBroker方法返回結果，增加sellList和buyList兩個字段，等同於brokerAskList和brokerBidList feat: 修改subQotUpdateBroker方法事件傳遞的經紀隊列，增加sellList和buyList兩個字段，等同於brokerAskList和brokerBidList feat: 修改qotGetStaticInfo返回結果，直接返回數組 feat: 修改qotGetSecuritySnapShot返回結果，直接返回數組，並支持超過200支以上股票的查詢。 feat: 新增按市價下單接口：trdPlaceOrderMarket(param)，直到交易完成成功為止，返回買入/賣出總價 feat: 新增取消注冊訂單更新接口：unsubTrdUpdateOrder() docs: 其他調整 更多請點擊查看更新日志 × Search results Close Documentation generated by JSDoc 3.5.5 on 2018-08-28T13:24:55+08:00 using the DocStrap template. "},"FutuQuant.html":{"id":"FutuQuant.html","title":"Class: FutuQuant","body":" FutuQuant-Nodejs Classes FutuQuantSocket Global Global Class: FutuQuant FutuQuant 封裝FutuQuant底層協議模塊 new FutuQuant(params [, logger]) Creates an instance of FutuQuant. Parameters: Name Type Argument Description params object 初始化參數 Properties Name Type Argument Description ip string FutuOpenD服務IP port number FutuOpenD服務端口 userID number 牛牛號 pwdMd5 string 解鎖交易 md5 market TrdMarket &lt;optional&gt; 市場環境，默認為港股環境，1港股2美股3大陸市場4香港A股通市場 env TrdEnv &lt;optional&gt; 0為仿真環境，1為真實環境，2為回測環境，默認為1 logger object &lt;optional&gt; 日志對象，若不傳入，則使用bunyan.createLogger創建 Source: futuquant.js, line 12 Members &lt;async, constant&gt; subQotUpdateOrderBook :QotGetOrderBookResponse 注冊買賣盤推送，需要先調用訂閱接口 Qot_UpdateOrderBook.proto - 3013推送買賣盤 Type: QotGetOrderBookResponse Source: futuquant.js, line 397 Methods close() 斷開連接 Source: futuquant.js, line 133 &lt;async&gt; getGlobalState() GetGlobalState.proto - 1002獲取全局狀態 Source: futuquant.js, line 159 Returns: Type GetGlobalStateResponse &lt;async&gt; init() 初始化處理 Source: futuquant.js, line 74 &lt;async&gt; initConnect(params) InitConnect.proto - 1001初始化連接 nodejs版本會根據返回的keepAliveInterval字段自動保持心跳連接，不再需要手動調用ft.keepLive()方法。 請求其它協議前必須等InitConnect協議先完成 若FutuOpenD配置了加密， 「connAESKey」將用於後續協議加密 keepAliveInterval 為建議client發起心跳 KeepAlive 的間隔 Parameters: Name Type Description params object 初始化參數 Properties Name Type Description clientVer number 客戶端版本號，clientVer = &quot;.&quot;以前的數 100 + &quot;.&quot;以後的，舉例：1.1版本的clientVer為1 100 + 1 = 101，2.21版本為2 * 100 + 21 = 221 clientID string 客戶端唯一標識，無生具體生成規則，客戶端自己保證唯一性即可 recvNotify boolean 此連接是否接收市場狀態、交易需要重新解鎖等等事件通知，true代表接收，FutuOpenD就會向此連接推送這些通知，反之false代表不接收不推送 Source: futuquant.js, line 107 Returns: Type InitConnectResponse &lt;async&gt; keepAlive() KeepAlive.proto - 1004保活心跳 Source: futuquant.js, line 168 Returns: time 服務器回包時的格林威治時間戳，單位秒 Type number &lt;async&gt; limitExecTimes(interval, times, fn) 限制接口調用頻率 Parameters: Name Type Description interval Number 限頻間隔 times Number 次數 fn function 要執行的函數 Source: futuquant.js, line 718 &lt;async&gt; qotGetBasicQot(securityList) Qot_GetBasicQot.proto - 3004獲取股票基本行情 股票結構參考 Security 基本報價結構參考 BasicQot Parameters: Name Type Description securityList Array.&lt;Security&gt; 股票列表 Source: futuquant.js, line 252 Returns: basicQotList 股票基本報價 Type Array.&lt;BasicQot&gt; &lt;async&gt; qotGetBroker(security) Qot_GetBroker.proto - 3014獲取經紀隊列 Parameters: Name Type Description security Security Object 股票 Source: futuquant.js, line 421 Returns: Type QotGetBrokerResponse &lt;async&gt; qotGetHistoryKL(params) Qot_GetHistoryKL.proto - 3100獲取單只股票一段歷史K線 Parameters: Name Type Description params object Properties Name Type Argument Description rehabType RehabType Qot_Common.RehabType,復權類型 klType KLType Qot_Common.KLType,K線類型 security Security 股票市場以及股票代碼 beginTime string 開始時間字符串 endTime string 結束時間字符串 maxAckKLNum number &lt;optional&gt; 最多返回多少根K線，如果未指定表示不限制 needKLFieldsFlag number &lt;optional&gt; 指定返回K線結構體特定某幾項數據，KLFields枚舉值或組合，如果未指定返回全部字段 Source: futuquant.js, line 460 Returns: Type Array.&lt;KLine&gt; &lt;async&gt; qotGetHistoryKLPoints(params) Qot_GetHistoryKLPoints.proto - 3101獲取多只股票多點歷史K線 復權類型參考 RehabType K線類型參考 KLType 股票結構參考 Security K線結構參考 KLine K線字段類型參考 KLFields 目前限制最多5個時間點，股票個數不做限制，但不建議傳入過多股票，查詢耗時過多會導致協議返回超時。 Parameters: Name Type Description params object Properties Name Type Argument Description rehabType RehabType Qot_Common.RehabType,復權類型 klType KLType Qot_Common.KLType,K線類型 noDataMode NoDataMode NoDataMode,當請求時間點數據為空時，如何返回數據 securityList Array.&lt;Security&gt; 股票市場以及股票代碼 timeList Array.&lt;string&gt; 時間字符串 maxReqSecurityNum number &lt;optional&gt; 最多返回多少只股票的數據，如果未指定表示不限制 needKLFieldsFlag KLFields &lt;optional&gt; 指定返回K線結構體特定某幾項數據，KLFields枚舉值或組合，如果未指定返回全部字段 Source: futuquant.js, line 523 Returns: Type Array.&lt;SecurityHistoryKLPoints&gt; &lt;async&gt; qotGetKL(params) Qot_GetKL.proto - 3006獲取K線 復權類型參考 RehabType K線類型參考 KLType 股票結構參考 Security K線結構參考 KLine 請求K線目前最多最近1000根 Parameters: Name Type Description params object Properties Name Type Description rehabType RehabType Qot_Common.RehabType,復權類型 klType KLType Qot_Common.KLType,K線類型 security Security 股票 reqNum number 請求K線根數 Source: futuquant.js, line 283 Returns: k線點 Type Array.&lt;KLine&gt; &lt;async&gt; qotGetOrderBook(security, num) Qot_GetOrderBook.proto - 3012獲取買賣盤，需要先調用訂閱接口 Parameters: Name Type Default Description security Security 股票 num number 10 請求的擺盤個數（1-10），默認10 Source: futuquant.js, line 377 Returns: Type QotGetOrderBookResponse &lt;async&gt; qotGetPlateSecurity(plate) Qot_GetPlateSecurity.proto - 3205獲取板塊下的股票 Parameters: Name Type Description plate Security 板塊 Source: futuquant.js, line 757 Returns: 板塊下的股票靜態信息 Type Array.&lt;SecurityStaticInfo&gt; &lt;async&gt; qotGetPlateSet(market, plateSetType) Qot_GetPlateSet.proto - 3204獲取板塊集合下的板塊 Parameters: Name Type Default Description market QotMarket 1 Qot_Common.QotMarket,股票市場 plateSetType PlateSetType Qot_Common.PlateSetType,板塊集合的類型 Source: futuquant.js, line 745 Returns: 板塊集合下的板塊信息 Type Array.&lt;PlateInfo&gt; &lt;async&gt; qotGetReference(security [, referenceType]) Qot_GetReference.proto - 3206 獲取正股相關股票 Parameters: Name Type Argument Default Description security security 股票 referenceType ReferenceType &lt;optional&gt; 1 相關類型，默認為1，獲取正股相關的渦輪 Source: futuquant.js, line 775 &lt;async&gt; qotGetRehab(securityList) Qot_GetRehab.proto - 3102獲取復權信息 Parameters: Name Type Description securityList Array.&lt;Security&gt; 股票列表 Source: futuquant.js, line 588 Returns: securityRehabList 多支股票的復權信息 Type Array.&lt;SecurityRehab&gt; &lt;async&gt; qotGetRT(security) Qot_GetRT.proto - 3008獲取分時 Parameters: Name Type Description security Security 股票 Source: futuquant.js, line 314 Returns: 分時點 Type Array.&lt;TimeShare&gt; &lt;async&gt; qotGetSecuritySnapShot(securityList) Qot_GetSecuritySnapshot.proto - 3203獲取股票快照 股票結構參考 Security 限頻接口：30秒內最多10次 最多可傳入200只股票 Parameters: Name Type Description securityList Array.&lt;Security&gt; 股票列表 Source: futuquant.js, line 695 Returns: snapshotList 股票快照 Type Array.&lt;Snapshot&gt; &lt;async&gt; qotGetStaticInfo(market, secType) Qot_GetStaticInfo.proto - 3202獲取股票靜態信息 Parameters: Name Type Default Description market QotMarket 1 Qot_Common.QotMarket,股票市場 secType SecurityType Qot_Common.SecurityType,股票類型 Source: futuquant.js, line 621 Returns: 靜態信息數組 Type Array.&lt;SecurityStaticInfo&gt; &lt;async&gt; qotGetSubInfo( [isReqAllConn]) Qot_GetSubInfo.proto - 3003獲取訂閱信息 Parameters: Name Type Argument Default Description isReqAllConn boolean &lt;optional&gt; false 是否返回所有連接的訂閱狀態，默認false Source: futuquant.js, line 238 Returns: Type QotGetSubInfoResponse &lt;async&gt; qotGetTicker(security, maxRetNum) Qot_GetTicker.proto - 3010獲取逐筆 股票結構參考 Security 逐筆結構參考 Ticker 請求逐筆目前最多最近1000個 Parameters: Name Type Default Description security Security 股票 maxRetNum number 100 最多返回的逐筆個數,實際返回數量不一定會返回這麼多,最多返回1000個，默認100 Source: futuquant.js, line 339 Returns: 逐筆 Type Array.&lt;Ticker&gt; &lt;async&gt; qotGetTradeDate(market, beginTime, endTime) Qot_GetTradeDate.proto - 3200獲取市場交易日 Parameters: Name Type Default Description market QotMarket 1 Qot_Common.QotMarket,股票市場 beginTime string 開始時間字符串 2018-01-01 00:00:00 endTime string 結束時間字符串 2018-02-01 00:00:00 Source: futuquant.js, line 607 Returns: tradeDateList 交易日 Type Array.&lt;TradeDate&gt; &lt;async&gt; qotRegQotPush(params) Qot_RegQotPush.proto - 3002注冊行情推送 股票結構參考 Security 訂閱數據類型參考 SubType 復權類型參考 RehabType 行情需要訂閱成功才能注冊推送 Parameters: Name Type Description params object Object Properties Name Type Argument Default Description securityList Array.&lt;Security&gt; 股票 subTypeList Array.&lt;SubType&gt; Qot_Common.SubType,訂閱數據類型 rehabTypeList Array.&lt;SubType&gt; Qot_Common.RehabType,復權類型,注冊K線類型才生效,其他訂閱類型忽略該參數,注冊K線時該參數不指定默認前復權 isRegOrUnReg boolean &lt;optional&gt; true 注冊或取消 isFirstPush boolean &lt;optional&gt; true 注冊後如果本地已有數據是否首推一次已存在數據,該參數不指定則默認true Source: futuquant.js, line 216 &lt;async&gt; qotSub(params) Qot_Sub.proto - 3001訂閱或者反訂閱 股票結構參考 Security 訂閱數據類型參考 SubType 復權類型參考 RehabType 為控制定閱產生推送數據流量，股票定閱總量有額度控制，訂閱規則參考 高頻數據接口 高頻數據接口需要訂閱之後才能使用，注冊推送之後才可以收到數據更新推送 Parameters: Name Type Description params object Properties Name Type Argument Default Description securityList Array.&lt;Security&gt; 股票 subTypeList Array.&lt;SubType&gt; Qot_Common.SubType,訂閱數據類型 isSubOrUnSub boolean &lt;optional&gt; true ture表示訂閱,false表示反訂閱 isRegOrUnRegPush boolean &lt;optional&gt; true 是否注冊或反注冊該連接上面行情的推送,該參數不指定不做注冊反注冊操作 regPushRehabTypeList number Qot_Common.RehabType,復權類型,注冊推送並且是K線類型才生效,其他訂閱類型忽略該參數,注冊K線推送時該參數不指定默認前復權 isFirstPush boolean &lt;optional&gt; true 注冊後如果本地已有數據是否首推一次已存在數據,該參數不指定則默認true Source: futuquant.js, line 191 setCommonTradeHeader(trdEnv, accID [, trdMarket]) 設置交易模塊的公共header，調用交易相關接口前必須先調用此接口。 Parameters: Name Type Argument Default Description trdEnv TrdEnv 1 交易環境, 參見TrdEnv的枚舉定義。0為仿真，1為真實，默認為1。 accID number 業務賬號, 業務賬號與交易環境、市場權限需要匹配，否則會返回錯誤，默認為當前userID trdMarket TrdMarket &lt;optional&gt; 1 交易市場, 參見TrdMarket的枚舉定義，默認為1，即香港市場。 Source: futuquant.js, line 829 &lt;async&gt; subQotUpdateBasicQot(callback) 注冊股票基本報價通知，需要先調用訂閱接口 Qot_UpdateBasicQot.proto - 3005推送股票基本報價 Parameters: Name Type Description callback function 回調 Source: futuquant.js, line 264 Returns: basicQotList Type Array.&lt;BasicQot&gt; &lt;async&gt; subQotUpdateBroker(callback) 注冊經紀隊列推送，需要先調用訂閱接口 Qot_UpdateBroker.proto - 3015推送經紀隊列 Parameters: Name Type Description callback function 回調 Source: futuquant.js, line 438 Returns: Type QotGetBrokerResponse &lt;async&gt; subQotUpdateKL() 注冊K線推送，需要先調用訂閱接口 Qot_UpdateKL.proto - 3007推送K線 Source: futuquant.js, line 305 Returns: 推送的k線點 Type QotUpdateKLResponse &lt;async&gt; subQotUpdateRT() 注冊分時推送，需要先調用訂閱接口 Qot_UpdateRT.proto - 3009推送分時 Source: futuquant.js, line 325 Returns: 分時點 Type Array.&lt;TimeShare&gt; &lt;async&gt; subQotUpdateTicker(callback) 注冊逐筆推送，需要先調用訂閱接口 Qot_UpdateTicker.proto - 3011推送逐筆 Parameters: Name Type Description callback function 回調 Source: futuquant.js, line 358 Returns: 逐筆 Type subQotUpdateTickerResponse &lt;async&gt; subTrdUpdateOrder(callback) 注冊訂單更新通知 Trd_UpdateOrder.proto - 2208推送訂單更新 Parameters: Name Type Description callback function 回調 Source: futuquant.js, line 1047 Returns: 訂單結構 Type Order &lt;async&gt; subTrdUpdateOrderFill(callback) 注冊新成交通知 Trd_UpdateOrderFill.proto - 2218推送新成交 Parameters: Name Type Description callback function 回調 Source: futuquant.js, line 1077 Returns: 成交結構 Type OrderFill &lt;async&gt; trdGetAccList() Trd_GetAccList.proto - 2001獲取交易賬戶列表 Source: futuquant.js, line 786 Returns: 交易業務賬戶列表 Type Array.&lt;TrdAcc&gt; &lt;async&gt; trdGetFunds() Trd_GetFunds.proto - 2101獲取賬戶資金，需要先設置交易模塊公共header Source: futuquant.js, line 841 Returns: Type Funds &lt;async&gt; trdGetHistoryOrderFillList(filterConditions) Trd_GetHistoryOrderFillList.proto - 2222獲取歷史成交列表 交易公共參數頭結構參考 TrdHeader 成交結構參考 OrderFill 過濾條件結構參考 TrdFilterConditions 限頻接口：30秒內最多10次 Parameters: Name Type Description filterConditions TrdFilterConditions 過濾條件 Source: futuquant.js, line 1112 Returns: 歷史成交列表 Type Array.&lt;OrderFill&gt; &lt;async&gt; trdGetHistoryOrderList(filterConditions, filterStatusList) Trd_GetHistoryOrderList.proto - 2221獲取歷史訂單列表 交易公共參數頭結構參考 TrdHeader 訂單結構參考 Order 過濾條件結構參考 TrdFilterConditions 訂單狀態枚舉參考 OrderStatus 限頻接口：30秒內最多10次 Parameters: Name Type Description filterConditions TrdFilterConditions 過濾條件 filterStatusList OrderStatus OrderStatus, 需要過濾的訂單狀態列表 Source: futuquant.js, line 1093 Returns: 歷史訂單列表 Type Array.&lt;Order&gt; &lt;async&gt; trdGetMaxTrdQtys(params) Trd_GetMaxTrdQtys.proto - 2111獲取最大交易數量 Parameters: Name Type Description params object Properties Name Type Argument Description header TrdHeader &lt;optional&gt; 交易公共參數頭，默認不用填寫 orderType OrderType 訂單類型, 參見Trd_Common.OrderType的枚舉定義 code string 代碼 price number &lt;optional&gt; 價格，3位精度(A股2位) orderID number 訂單號，新下訂單不需要，如果是修改訂單就需要把原訂單號帶上才行，因為改單的最大買賣數量會包含原訂單數量。 以下為調整價格使用，目前僅對港、A股有效，因為港股有價位，A股2位精度，美股不需要 adjustPrice boolean &lt;optional&gt; 是否調整價格，如果價格不合法，是否調整到合法價位，true調整，false不調整 adjustSideAndLimit number &lt;optional&gt; 調整方向和調整幅度百分比限制，正數代表向上調整，負數代表向下調整，具體值代表調整幅度限制，如：0.015代表向上調整且幅度不超過1.5%；-0.01代表向下調整且幅度不超過1% Source: futuquant.js, line 877 Returns: 最大交易數量結構體 Type MaxTrdQtys &lt;async&gt; trdGetOrderFillList(filterConditions) Trd_GetOrderFillList.proto - 2211獲取成交列表 Parameters: Name Type Description filterConditions TrdFilterConditions 過濾條件 Source: futuquant.js, line 1064 Returns: 成交列表 Type Array.&lt;OrderFill&gt; &lt;async&gt; trdGetOrderList(filterConditions, filterStatusList) Trd_GetOrderList.proto - 2201獲取訂單列表 Parameters: Name Type Description filterConditions TrdFilterConditions 過濾條件 filterStatusList Array.&lt;OrderStatus&gt; 需要過濾的訂單狀態列表 Source: futuquant.js, line 897 Returns: 訂單列表 Type Array.&lt;Order&gt; &lt;async&gt; trdGetPositionList(filterConditions, filterPLRatioMin, filterPLRatioMax) Trd_GetPositionList.proto - 2102獲取持倉列表 Parameters: Name Type Description filterConditions TrdFilterConditions 過濾條件 filterPLRatioMin number 過濾盈虧比例下限，高於此比例的會返回，如0.1，返回盈虧比例大於10%的持倉 filterPLRatioMax number 過濾盈虧比例上限，低於此比例的會返回，如0.2，返回盈虧比例小於20%的持倉 Source: futuquant.js, line 855 Returns: 持倉列表數組 Type Array.&lt;Position&gt; &lt;async&gt; trdModifyOrder(params) Trd_ModifyOrder.proto - 2205修改訂單(改價、改量、改狀態等) 請求包標識結構參考 PacketID 交易公共參數頭結構參考 TrdHeader 修改操作枚舉參考 ModifyOrderOp 限頻接口：30秒內最多30次 Parameters: Name Type Description params object Properties Name Type Argument Description packetID PacketID &lt;optional&gt; 交易寫操作防重放攻擊，默認不用填寫 header TrdHeader &lt;optional&gt; 交易公共參數頭，默認不用填寫 orderID number 訂單號，forAll為true時，傳0 modifyOrderOp ModifyOrderOp 修改操作類型，參見Trd_Common.ModifyOrderOp的枚舉定義 forAll boolean &lt;optional&gt; 是否對此業務賬戶的全部訂單操作，true是，false否(對單個訂單)，無此字段代表false，僅對單個訂單 下面的字段僅在modifyOrderOp為ModifyOrderOp_Normal有效 qty number &lt;optional&gt; 數量，2位精度，期權單位是&quot;張&quot; price number &lt;optional&gt; 價格，3位精度(A股2位) 以下為調整價格使用，目前僅對港、A股有效，因為港股有價位，A股2位精度，美股不需要 adjustPrice boolean &lt;optional&gt; 是否調整價格，如果價格不合法，是否調整到合法價位，true調整，false不調整 adjustSideAndLimit number &lt;optional&gt; 調整方向和調整幅度百分比限制，正數代表向上調整，負數代表向下調整，具體值代表調整幅度限制，如：0.015代表向上調整且幅度不超過1.5%；-0.01代表向下調整且幅度不超過1% Source: futuquant.js, line 1022 Returns: orderID 訂單號 Type number &lt;async&gt; trdPlaceOrder(params) Trd_PlaceOrder.proto - 2202下單 請求包標識結構參考 PacketID 交易公共參數頭結構參考 TrdHeader 交易方向枚舉參考 TrdSide 訂單類型枚舉參考 OrderType 限頻接口：30秒內最多30次 Parameters: Name Type Description params object Properties Name Type Argument Description packetID PacketID &lt;optional&gt; 交易寫操作防重放攻擊，默認不用填寫 header TrdHeader &lt;optional&gt; 交易公共參數頭，默認不用填寫 trdSide TrdSide 交易方向, 參見Trd_Common.TrdSide的枚舉定義 orderType OrderType 訂單類型, 參見Trd_Common.OrderType的枚舉定義 code string 代碼 qty number 數量，2位精度，期權單位是&quot;張&quot; price number &lt;optional&gt; 價格，3位精度(A股2位) 以下為調整價格使用，目前僅對港、A股有效，因為港股有價位，A股2位精度，美股不需要 adjustPrice boolean &lt;optional&gt; 是否調整價格，如果價格不合法，是否調整到合法價位，true調整，false不調整 adjustSideAndLimit number &lt;optional&gt; 調整方向和調整幅度百分比限制，正數代表向上調整，負數代表向下調整，具體值代表調整幅度限制，如：0.015代表向上調整且幅度不超過1.5%；-0.01代表向下調整且幅度不超過1% Source: futuquant.js, line 927 Returns: orderID 訂單號 Type number &lt;async&gt; trdPlaceOrderMarket(param) 2202市價下單，直到成功為止，返回買入/賣出的總價格 Parameters: Name Type Description param object params.trdSide TrdSide 交易方向, 參見Trd_Common.TrdSide的枚舉定義 params.code string 代碼 params.qty number 數量，2位精度，期權單位是&quot;張&quot; Source: futuquant.js, line 955 Returns: 賣出/買入總價 Type number &lt;async&gt; trdSubAccPush(accIDList) Trd_SubAccPush.proto - 2008訂閱接收交易賬戶的推送數據 Parameters: Name Type Description accIDList Array.&lt;number&gt; 要接收推送數據的業務賬號列表，全量非增量，即使用者請每次傳需要接收推送數據的所有業務賬號 Source: futuquant.js, line 818 &lt;async&gt; trdUnlockTrade( [unlock] [, pwdMD5]) Trd_UnlockTrade.proto - 2005解鎖或鎖定交易 除2001協議外，所有交易協議請求都需要FutuOpenD先解鎖交易 密碼MD5方式獲取請參考 FutuOpenD配置 內的login_pwd_md5字段 解鎖或鎖定交易針對與FutuOpenD，只要有一個連接解鎖，其他連接都可以調用交易接口 強烈建議有實盤交易的用戶使用加密通道，參考 加密通信流程 限頻接口：30秒內最多10次 Parameters: Name Type Argument Default Description unlock boolean &lt;optional&gt; true true解鎖交易，false鎖定交易，默認true pwdMD5 string &lt;optional&gt; 交易密碼的MD5轉16進制(全小寫)，解鎖交易必須要填密碼，鎖定交易不需要驗證密碼，可不填 Source: futuquant.js, line 806 &lt;async&gt; unsubTrdUpdateOrder() 取消注冊訂單更新通知 Trd_UpdateOrder.proto - 2208推送訂單更新 Source: futuquant.js, line 1055 × Search results Close Documentation generated by JSDoc 3.5.5 on 2018-08-28T13:24:55+08:00 using the DocStrap template. "},"Socket.html":{"id":"Socket.html","title":"Class: Socket","body":" FutuQuant-Nodejs Classes FutuQuantSocket Global Global Class: Socket Socket Socket模塊 new Socket(ip, port, logger) Creates an instance of Socket. Parameters: Name Type Description ip string OpenD服務Ip port number OpenD服務端口 logger object 日志對象 Source: socket.js, line 19 Members id :number socket id，自增，用於區分多個socket。 Type: number Source: socket.js, line 48 ip :string OpenD服務IP Type: string Source: socket.js, line 31 isConnect :boolean socket是否已經連接 Type: boolean Source: socket.js, line 58 logger :object 日志對象 Type: object Source: socket.js, line 41 name :string socket名稱，用於區分多個socket。 Type: string Source: socket.js, line 53 port :number OpenD服務端口 Type: number Source: socket.js, line 36 requestId :number 請求序列號，自增 Type: number Source: socket.js, line 63 Methods &lt;async&gt; connect() 立即建立連接 Source: socket.js, line 111 onConnect(cb) 設置連接成功的回調函數 Parameters: Name Type Description cb function Source: socket.js, line 142 parseData() 解析包體數據 Source: socket.js, line 216 &lt;async&gt; send(protoName, message) 發送數據 Parameters: Name Type Description protoName string 協議名稱 message object 要發送的數據 Source: socket.js, line 170 subNotify(protoId, callback) 注冊協議的通知 Parameters: Name Type Description protoId number 協議id callback function 回調函數 Source: socket.js, line 151 unsubNotify(protoId) 刪除一個通知 Parameters: Name Type Description protoId number 協議id Source: socket.js, line 158 × Search results Close Documentation generated by JSDoc 3.5.5 on 2018-08-28T13:24:55+08:00 using the DocStrap template. "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
